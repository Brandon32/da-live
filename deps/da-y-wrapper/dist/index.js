var Ja=Object.defineProperty;var qa=(n,e)=>{for(var t in e)Ja(n,t,{get:e[t],enumerable:!0})};var Gt={};qa(Gt,{AbsolutePosition:()=>kr,AbstractConnector:()=>vi,AbstractStruct:()=>Ht,AbstractType:()=>B,Array:()=>dt,ContentAny:()=>$e,ContentBinary:()=>ut,ContentDeleted:()=>Kt,ContentDoc:()=>pt,ContentEmbed:()=>Ve,ContentFormat:()=>I,ContentJSON:()=>In,ContentString:()=>oe,ContentType:()=>Z,Doc:()=>Re,GC:()=>K,ID:()=>_e,Item:()=>C,Map:()=>ft,PermanentUserData:()=>Ji,RelativePosition:()=>Ee,Skip:()=>q,Snapshot:()=>Ke,Text:()=>je,Transaction:()=>Tr,UndoManager:()=>at,UpdateDecoderV1:()=>Q,UpdateDecoderV2:()=>$,UpdateEncoderV1:()=>Te,UpdateEncoderV2:()=>se,XmlElement:()=>Y,XmlFragment:()=>Oe,XmlHook:()=>An,XmlText:()=>G,YArrayEvent:()=>Or,YEvent:()=>ht,YMapEvent:()=>Mr,YTextEvent:()=>Nr,YXmlEvent:()=>Ar,applyUpdate:()=>Zi,applyUpdateV2:()=>_r,cleanupYTextFormatting:()=>Zl,compareIDs:()=>ot,compareRelativePositions:()=>Ur,convertUpdateFormatV1ToV2:()=>gd,convertUpdateFormatV2ToV1:()=>Bl,createAbsolutePositionFromRelativePosition:()=>is,createDeleteSet:()=>jt,createDeleteSetFromStructStore:()=>Gi,createDocFromSnapshot:()=>td,createID:()=>w,createRelativePositionFromJSON:()=>gt,createRelativePositionFromTypeIndex:()=>_n,createSnapshot:()=>Un,decodeRelativePosition:()=>Gh,decodeSnapshot:()=>Zh,decodeSnapshotV2:()=>Cl,decodeStateVector:()=>ts,decodeUpdate:()=>ad,decodeUpdateV2:()=>Al,diffUpdate:()=>ud,diffUpdateV2:()=>os,emptySnapshot:()=>ed,encodeRelativePosition:()=>jh,encodeSnapshot:()=>Qh,encodeSnapshotV2:()=>kl,encodeStateAsUpdate:()=>es,encodeStateAsUpdateV2:()=>xl,encodeStateVector:()=>rs,encodeStateVectorFromUpdate:()=>hd,encodeStateVectorFromUpdateV2:()=>_l,equalDeleteSets:()=>yl,equalSnapshots:()=>Xh,findIndexSS:()=>de,findRootTypeKey:()=>mt,getItem:()=>bn,getState:()=>A,getTypeChildren:()=>Sd,isDeleted:()=>Be,isParentOf:()=>ct,iterateDeletedStructs:()=>ke,logType:()=>Yh,logUpdate:()=>cd,logUpdateV2:()=>Nl,mergeUpdates:()=>Il,mergeUpdatesV2:()=>Dn,obfuscateUpdate:()=>pd,obfuscateUpdateV2:()=>md,parseUpdateMeta:()=>dd,parseUpdateMetaV2:()=>Ul,readUpdate:()=>vh,readUpdateV2:()=>Qi,relativePositionToJSON:()=>Wh,snapshot:()=>ss,snapshotContainsUpdate:()=>rd,transact:()=>D,tryGc:()=>od,typeListToArraySnapshot:()=>Pr,typeMapGetAllSnapshot:()=>jl,typeMapGetSnapshot:()=>Cd});var _=()=>new Map,er=n=>{let e=_();return n.forEach((t,r)=>{e.set(r,t)}),e},F=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},so=(n,e)=>{let t=[];for(let[r,i]of n)t.push(e(i,r));return t},oo=(n,e)=>{for(let[t,r]of n)if(e(r,t))return!0;return!1};var te=()=>new Set;var tr=n=>n[n.length-1];var lo=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},me=Array.from;var co=(n,e)=>{for(let t=0;t<n.length;t++)if(e(n[t],t,n))return!0;return!1};var ao=(n,e)=>{let t=new Array(n);for(let r=0;r<n;r++)t[r]=e(r,t);return t};var an=Array.isArray;var ge=class{constructor(){this._observers=_()}on(e,t){F(this._observers,e,te).add(t)}once(e,t){let r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return me((this._observers.get(e)||_()).values()).forEach(r=>r(...t))}destroy(){this._observers=_()}};var H=Math.floor;var Nt=Math.abs;var ne=(n,e)=>n<e?n:e,ce=(n,e)=>n>e?n:e,vu=Number.isNaN,ho=Math.pow;var rr=n=>n!==0?n<0:1/n<0;var pi=Number.MAX_SAFE_INTEGER,zu=Number.MIN_SAFE_INTEGER,Ju=1<<31;var fo=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&H(n)===n),qu=Number.isNaN,Yu=Number.parseInt;var mi=String.fromCharCode,Wu=String.fromCodePoint,Hu=mi(65535),Ya=n=>n.toLowerCase(),Wa=/^\s*/g,Ha=n=>n.replace(Wa,""),Ka=/([A-Z])/g,gi=(n,e)=>Ha(n.replace(Ka,t=>`${e}${Ya(t)}`));var ja=n=>{let e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},It=typeof TextEncoder<"u"?new TextEncoder:null,$a=n=>It.encode(n),po=It?$a:ja;var At=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});At&&At.decode(new Uint8Array).length===1&&(At=null);var mo=(n,e)=>ao(e,()=>n).join("");var nt=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},U=()=>new nt;var sr=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e};var E=n=>{let e=new Uint8Array(sr(n)),t=0;for(let r=0;r<n.bufs.length;r++){let i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},Ga=(n,e)=>{let t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(ce(t,e)*2),n.cpos=0)},v=(n,e)=>{let t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e};var Vt=v;var m=(n,e)=>{for(;e>127;)v(n,128|127&e),e=H(e/128);v(n,127&e)},fn=(n,e)=>{let t=rr(e);for(t&&(e=-e),v(n,(e>63?128:0)|(t?64:0)|63&e),e=H(e/64);e>0;)v(n,(e>127?128:0)|127&e),e=H(e/128)},yi=new Uint8Array(3e4),Xa=yi.length/3,Qa=(n,e)=>{if(e.length<Xa){let t=It.encodeInto(e,yi).written||0;m(n,t);for(let r=0;r<t;r++)v(n,yi[r])}else N(n,po(e))},Za=(n,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;m(n,r);for(let i=0;i<r;i++)v(n,t.codePointAt(i))},ye=It&&It.encodeInto?Qa:Za;var So=(n,e)=>Bt(n,E(e)),Bt=(n,e)=>{let t=n.cbuf.length,r=n.cpos,i=ne(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(ce(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},N=(n,e)=>{m(n,e.byteLength),Bt(n,e)},wi=(n,e)=>{Ga(n,e);let t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},eh=(n,e)=>wi(n,4).setFloat32(0,e,!1),th=(n,e)=>wi(n,8).setFloat64(0,e,!1),nh=(n,e)=>wi(n,8).setBigInt64(0,e,!1);var yo=new DataView(new ArrayBuffer(4)),rh=n=>(yo.setFloat32(0,n),yo.getFloat32(0)===n),Ut=(n,e)=>{switch(typeof e){case"string":v(n,119),ye(n,e);break;case"number":fo(e)&&Nt(e)<=2147483647?(v(n,125),fn(n,e)):rh(e)?(v(n,124),eh(n,e)):(v(n,123),th(n,e));break;case"bigint":v(n,122),nh(n,e);break;case"object":if(e===null)v(n,126);else if(an(e)){v(n,117),m(n,e.length);for(let t=0;t<e.length;t++)Ut(n,e[t])}else if(e instanceof Uint8Array)v(n,116),N(n,e);else{v(n,118);let t=Object.keys(e);m(n,t.length);for(let r=0;r<t.length;r++){let i=t[r];ye(n,i),Ut(n,e[i])}}break;case"boolean":v(n,e?120:121);break;default:v(n,127)}},dn=class extends nt{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&m(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var wo=n=>{n.count>0&&(fn(n.encoder,n.count===1?n.s:-n.s),n.count>1&&m(n.encoder,n.count-2))},rt=class{constructor(){this.encoder=new nt,this.s=0,this.count=0}write(e){this.s===e?this.count++:(wo(this),this.count=1,this.s=e)}toUint8Array(){return wo(this),E(this.encoder)}};var xo=n=>{if(n.count>0){let e=n.diff*2+(n.count===1?0:1);fn(n.encoder,e),n.count>1&&m(n.encoder,n.count-2)}},Rt=class{constructor(){this.encoder=new nt,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(xo(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return xo(this),E(this.encoder)}},ir=class{constructor(){this.sarr=[],this.s="",this.lensE=new rt}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new nt;return this.sarr.push(this.s),this.s="",ye(e,this.sarr.join("")),Bt(e,this.lensE.toUint8Array()),E(e)}};var we=n=>new Error(n),re=()=>{throw we("Method unimplemented")},J=()=>{throw we("Unexpected case")};var bo=we("Unexpected end of array"),ko=we("Integer out of Range"),Pt=class{constructor(e){this.arr=e,this.pos=0}},R=n=>new Pt(n),xi=n=>n.pos!==n.arr.length;var ih=(n,e)=>{let t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},L=n=>ih(n,y(n));var it=n=>n.arr[n.pos++];var y=n=>{let e=0,t=1,r=n.arr.length;for(;n.pos<r;){let i=n.arr[n.pos++];if(e=e+(i&127)*t,t*=128,i<128)return e;if(e>pi)throw ko}throw bo},pn=n=>{let e=n.arr[n.pos++],t=e&63,r=64,i=(e&64)>0?-1:1;if(!(e&128))return i*t;let s=n.arr.length;for(;n.pos<s;){if(e=n.arr[n.pos++],t=t+(e&127)*r,r*=128,e<128)return i*t;if(t>pi)throw ko}throw bo};var sh=n=>{let e=y(n);if(e===0)return"";{let t=String.fromCodePoint(it(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(it(n));else for(;e>0;){let r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},oh=n=>At.decode(L(n)),he=At?oh:sh;var Si=(n,e)=>{let t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},lh=n=>Si(n,4).getFloat32(0,!1),ch=n=>Si(n,8).getFloat64(0,!1),ah=n=>Si(n,8).getBigInt64(0,!1);var hh=[n=>{},n=>null,pn,lh,ch,ah,n=>!1,n=>!0,he,n=>{let e=y(n),t={};for(let r=0;r<e;r++){let i=he(n);t[i]=Ft(n)}return t},n=>{let e=y(n),t=[];for(let r=0;r<e;r++)t.push(Ft(n));return t},L],Ft=n=>hh[127-it(n)](n),un=class extends Pt{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),xi(this)?this.count=y(this)+1:this.count=-1),this.count--,this.s}};var st=class extends Pt{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=pn(this);let e=rr(this.s);this.count=1,e&&(this.s=-this.s,this.count=y(this)+2)}return this.count--,this.s}};var Lt=class extends Pt{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=pn(this),t=e&1;this.diff=H(e/2),this.count=1,t&&(this.count=y(this)+2)}return this.s+=this.diff,this.count--,this.s}},cr=class{constructor(e){this.decoder=new st(e),this.str=he(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var $u=crypto.subtle,Co=crypto.getRandomValues.bind(crypto);var dh=Math.random,bi=()=>Co(new Uint32Array(1))[0];var To=n=>n[H(dh()*n.length)],fh="10000000-1000-4000-8000"+-1e11,Eo=()=>fh.replace(/[018]/g,n=>(n^bi()&15>>n/4).toString(16));var ie=Date.now;var ki=n=>new Promise(n);var Qu=Promise.all.bind(Promise);var Ci=n=>n===void 0?null:n;var Ti=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Oo=new Ti,Ei=!0;try{typeof localStorage<"u"&&localStorage&&(Oo=localStorage,Ei=!1)}catch{}var hr=Oo,Mo=n=>Ei||addEventListener("storage",n),No=n=>Ei||removeEventListener("storage",n);var Io=Object.assign,Di=Object.keys,_o=(n,e)=>{for(let t in n)e(n[t],t)},Uo=(n,e)=>{let t=[];for(let r in n)t.push(e(n[r],r));return t},gn=n=>Di(n).length;var Ro=n=>{for(let e in n)return!1;return!0},mh=(n,e)=>{for(let t in n)if(!e(n[t],t))return!1;return!0},Oi=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Mi=(n,e)=>n===e||gn(n)===gn(e)&&mh(n,(t,r)=>(t!==void 0||Oi(e,r))&&e[r]===t);var yn=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&yn(n,e,t+1)}};var Ni=n=>n,gh=(n,e)=>n===e;var vt=(n,e)=>{if(n==null||e==null)return gh(n,e);if(n.constructor!==e.constructor)return!1;if(n===e)return!0;switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(let t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(let t of n.keys())if(!e.has(t)||!vt(n.get(t),e.get(t)))return!1;break}case Object:if(gn(n)!==gn(e))return!1;for(let t in n)if(!Oi(n,t)||!vt(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!vt(n[t],e[t]))return!1;break;default:return!1}return!0},Vo=(n,e)=>e.includes(n);var ze=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",zt=typeof window<"u"&&typeof document<"u"&&!ze,Zu=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,xe,yh=[],wh=()=>{if(xe===void 0)if(ze){xe=_();let n=process.argv,e=null;for(let t=0;t<n.length;t++){let r=n[t];r[0]==="-"?(e!==null&&xe.set(e,""),e=r):e!==null?(xe.set(e,r),e=null):yh.push(r)}e!==null&&xe.set(e,"")}else typeof location=="object"?(xe=_(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){let[e,t]=n.split("=");xe.set(`--${gi(e,"-")}`,t),xe.set(`-${gi(e,"-")}`,t)}})):xe=_();return xe},Ii=n=>wh().has(n);var _i=n=>ze?Ci(process.env[n.toUpperCase()]):Ci(hr.getItem(n));var xh=n=>Ii("--"+n)||_i(n)!==null,ep=xh("production"),Bo=ze&&Vo(process.env.FORCE_COLOR,["true","1","2"]),Po=!Ii("no-colors")&&(!ze||process.stdout.isTTY||Bo)&&(!ze||Ii("color")||Bo||_i("COLORTERM")!==null||(_i("TERM")||"").includes("color"));var Fo=n=>new Uint8Array(n),Sh=(n,e,t)=>new Uint8Array(n,e,t),Lo=n=>new Uint8Array(n),bh=n=>{let e="";for(let t=0;t<n.byteLength;t++)e+=mi(n[t]);return btoa(e)},kh=n=>Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("base64"),Ch=n=>{let e=atob(n),t=Fo(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Th=n=>{let e=Buffer.from(n,"base64");return Sh(e.buffer,e.byteOffset,e.byteLength)},vo=zt?bh:kh,zo=zt?Ch:Th;var Jo=n=>{let e=Fo(n.byteLength);return e.set(n),e};var Ui=class{constructor(e,t){this.left=e,this.right=t}},Se=(n,e)=>new Ui(n,e);var Ie=typeof document<"u"?document:{};var tp=typeof DOMParser<"u"?new DOMParser:null;var Yo=n=>so(n,(e,t)=>`${t}:${e};`).join("");var np=Ie.ELEMENT_NODE,rp=Ie.TEXT_NODE,ip=Ie.CDATA_SECTION_NODE,sp=Ie.COMMENT_NODE,op=Ie.DOCUMENT_NODE,lp=Ie.DOCUMENT_TYPE_NODE,cp=Ie.DOCUMENT_FRAGMENT_NODE;var ur=n=>class{constructor(t){this._=t}destroy(){n(this._)}},Dh=ur(clearTimeout),Jt=(n,e)=>new Dh(setTimeout(e,n)),hp=ur(clearInterval);var dp=ur(n=>typeof requestAnimationFrame<"u"&&cancelAnimationFrame(n));var fp=ur(n=>typeof cancelIdleCallback<"u"&&cancelIdleCallback(n));var be=Symbol;var wn=be(),xn=be(),Ri=be(),Vi=be(),Bi=be(),Sn=be(),Pi=be(),qt=be(),Fi=be(),Ko=n=>{let e=[],t=[],r=0;for(;r<n.length;r++){let i=n[r];i.constructor===String||i.constructor===Number?e.push(i):i.constructor===Object&&t.push(JSON.stringify(i))}return t};var up=ie();var Nh={[wn]:Se("font-weight","bold"),[xn]:Se("font-weight","normal"),[Ri]:Se("color","blue"),[Bi]:Se("color","green"),[Vi]:Se("color","grey"),[Sn]:Se("color","red"),[Pi]:Se("color","purple"),[qt]:Se("color","orange"),[Fi]:Se("color","black")},Ah=n=>{let e=[],t=[],r=_(),i=[],s=0;for(;s<n.length;s++){let o=n[s],l=Nh[o];if(l!==void 0)r.set(l.left,l.right);else if(o.constructor===String||o.constructor===Number){let c=Yo(r);s>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){let o=n[s];o instanceof Symbol||i.push(o)}return i},jo=Po?Ah:Ko,pr=(...n)=>{console.log(...jo(n)),Go.forEach(e=>e.print(n))},$o=(...n)=>{console.warn(...jo(n)),n.unshift(qt),Go.forEach(e=>e.print(n))};var Go=te();var Xo=n=>({[Symbol.iterator](){return this},next:n}),Qo=(n,e)=>Xo(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),mr=(n,e)=>Xo(()=>{let{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});var vi=class extends ge{constructor(e,t){super(),this.doc=e,this.awareness=t}},Cn=class{constructor(e,t){this.clock=e,this.len=t}},We=class{constructor(){this.clients=new Map}},ke=(n,e,t)=>e.clients.forEach((r,i)=>{let s=n.doc.store.clients.get(i);for(let o=0;o<r.length;o++){let l=r[o];El(n,s,l.clock,l.len,t)}}),Vh=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){let i=H((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},Be=(n,e)=>{let t=n.clients.get(e.client);return t!==void 0&&Vh(t,e.clock)!==null},$i=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=ce(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Yt=n=>{let e=new We;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){let s=r.slice();for(let o=t+1;o<n.length;o++)lo(s,n[o].clients.get(i)||[]);e.clients.set(i,s)}});return $i(e),e},Tn=(n,e,t,r)=>{F(n.clients,e,()=>[]).push(new Cn(t,r))},jt=()=>new We,Gi=n=>{let e=jt();return n.clients.forEach((t,r)=>{let i=[];for(let s=0;s<t.length;s++){let o=t[s];if(o.deleted){let l=o.id.clock,c=o.length;if(s+1<t.length)for(let a=t[s+1];s+1<t.length&&a.deleted;a=t[++s+1])c+=a.length;i.push(new Cn(l,c))}}i.length>0&&e.clients.set(r,i)}),e},Ce=(n,e)=>{m(n.restEncoder,e.clients.size),me(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),m(n.restEncoder,t);let i=r.length;m(n.restEncoder,i);for(let s=0;s<i;s++){let o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},Ue=n=>{let e=new We,t=y(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();let i=y(n.restDecoder),s=y(n.restDecoder);if(s>0){let o=F(e.clients,i,()=>[]);for(let l=0;l<s;l++)o.push(new Cn(n.readDsClock(),n.readDsLen()))}}return e},tl=(n,e,t)=>{let r=new We,i=y(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();let o=y(n.restDecoder),l=y(n.restDecoder),c=t.clients.get(o)||[],a=A(t,o);for(let h=0;h<l;h++){let d=n.readDsClock(),f=d+n.readDsLen();if(d<a){a<f&&Tn(r,o,a,f-a);let u=de(c,d),p=c[u];for(!p.deleted&&p.id.clock<d&&(c.splice(u+1,0,Ir(e,p,d-p.id.clock)),u++);u<c.length&&(p=c[u++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(u,0,Ir(e,p,f-p.id.clock)),p.delete(e))}else Tn(r,o,d,f-d)}}if(r.clients.size>0){let s=new se;return m(s.restEncoder,0),Ce(s,r),s.toUint8Array()}return null},yl=(n,e)=>{if(n.clients.size!==e.clients.size)return!1;for(let[t,r]of n.clients.entries()){let i=e.clients.get(t);if(i===void 0||r.length!==i.length)return!1;for(let s=0;s<r.length;s++){let o=r[s],l=i[s];if(o.clock!==l.clock||o.len!==l.len)return!1}}return!0},wl=bi,Re=class n extends ge{constructor({guid:e=Eo(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=wl(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Cr,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=ki(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});let c=()=>ki(a=>{let h=d=>{(d===void 0||d===!0)&&(this.off("sync",h),a())};this.on("sync",h)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[])}),this.whenSynced=c()}load(){let e=this._item;e!==null&&!this.shouldLoad&&D(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(me(this.subdocs).map(e=>e.guid))}transact(e,t=null){return D(this,e,t)}get(e,t=B){let r=F(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==B&&i!==t)if(i===B){let s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,dt)}getText(e=""){return this.get(e,je)}getMap(e=""){return this.get(e,ft)}getXmlFragment(e=""){return this.get(e,Oe)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){me(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new n({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,D(e.parent.doc,r=>{let i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}},lt=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return y(this.restDecoder)}readDsLen(){return y(this.restDecoder)}},Q=class extends lt{readLeftID(){return w(y(this.restDecoder),y(this.restDecoder))}readRightID(){return w(y(this.restDecoder),y(this.restDecoder))}readClient(){return y(this.restDecoder)}readInfo(){return it(this.restDecoder)}readString(){return he(this.restDecoder)}readParentInfo(){return y(this.restDecoder)===1}readTypeRef(){return y(this.restDecoder)}readLen(){return y(this.restDecoder)}readAny(){return Ft(this.restDecoder)}readBuf(){return Jo(L(this.restDecoder))}readJSON(){return JSON.parse(he(this.restDecoder))}readKey(){return he(this.restDecoder)}},br=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=y(this.restDecoder),this.dsCurrVal}readDsLen(){let e=y(this.restDecoder)+1;return this.dsCurrVal+=e,e}},$=class extends br{constructor(e){super(e),this.keys=[],y(e),this.keyClockDecoder=new Lt(L(e)),this.clientDecoder=new st(L(e)),this.leftClockDecoder=new Lt(L(e)),this.rightClockDecoder=new Lt(L(e)),this.infoDecoder=new un(L(e),it),this.stringDecoder=new cr(L(e)),this.parentInfoDecoder=new un(L(e),it),this.typeRefDecoder=new st(L(e)),this.lenDecoder=new st(L(e))}readLeftID(){return new _e(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new _e(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ft(this.restDecoder)}readBuf(){return L(this.restDecoder)}readJSON(){return Ft(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},He=class{constructor(){this.restEncoder=U()}toUint8Array(){return E(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){m(this.restEncoder,e)}writeDsLen(e){m(this.restEncoder,e)}},Te=class extends He{writeLeftID(e){m(this.restEncoder,e.client),m(this.restEncoder,e.clock)}writeRightID(e){m(this.restEncoder,e.client),m(this.restEncoder,e.clock)}writeClient(e){m(this.restEncoder,e)}writeInfo(e){Vt(this.restEncoder,e)}writeString(e){ye(this.restEncoder,e)}writeParentInfo(e){m(this.restEncoder,e?1:0)}writeTypeRef(e){m(this.restEncoder,e)}writeLen(e){m(this.restEncoder,e)}writeAny(e){Ut(this.restEncoder,e)}writeBuf(e){N(this.restEncoder,e)}writeJSON(e){ye(this.restEncoder,JSON.stringify(e))}writeKey(e){ye(this.restEncoder,e)}},Wt=class{constructor(){this.restEncoder=U(),this.dsCurrVal=0}toUint8Array(){return E(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,m(this.restEncoder,t)}writeDsLen(e){e===0&&J(),m(this.restEncoder,e-1),this.dsCurrVal+=e}},se=class extends Wt{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Rt,this.clientEncoder=new rt,this.leftClockEncoder=new Rt,this.rightClockEncoder=new Rt,this.infoEncoder=new dn(Vt),this.stringEncoder=new ir,this.parentInfoEncoder=new dn(Vt),this.typeRefEncoder=new rt,this.lenEncoder=new rt}toUint8Array(){let e=U();return m(e,0),N(e,this.keyClockEncoder.toUint8Array()),N(e,this.clientEncoder.toUint8Array()),N(e,this.leftClockEncoder.toUint8Array()),N(e,this.rightClockEncoder.toUint8Array()),N(e,E(this.infoEncoder)),N(e,this.stringEncoder.toUint8Array()),N(e,E(this.parentInfoEncoder)),N(e,this.typeRefEncoder.toUint8Array()),N(e,this.lenEncoder.toUint8Array()),Bt(e,E(this.restEncoder)),E(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ut(this.restEncoder,e)}writeBuf(e){N(this.restEncoder,e)}writeJSON(e){Ut(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Bh=(n,e,t,r)=>{r=ce(r,e[0].id.clock);let i=de(e,r);m(n.restEncoder,e.length-i),n.writeClient(t),m(n.restEncoder,r);let s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},Xi=(n,e,t)=>{let r=new Map;t.forEach((i,s)=>{A(e,s)>i&&r.set(s,i)}),Rn(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),m(n.restEncoder,r.size),me(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Bh(n,e.clients.get(i),i,s)})},Ph=(n,e)=>{let t=_(),r=y(n.restDecoder);for(let i=0;i<r;i++){let s=y(n.restDecoder),o=new Array(s),l=n.readClient(),c=y(n.restDecoder);t.set(l,{i:0,refs:o});for(let a=0;a<s;a++){let h=n.readInfo();switch(31&h){case 0:{let d=n.readLen();o[a]=new K(w(l,c),d),c+=d;break}case 10:{let d=y(n.restDecoder);o[a]=new q(w(l,c),d),c+=d;break}default:{let d=(h&192)===0,f=new C(w(l,c),null,(h&128)===128?n.readLeftID():null,null,(h&64)===64?n.readRightID():null,d?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,d&&(h&32)===32?n.readString():null,nc(n,h));o[a]=f,c+=f.length}}}}return t},Fh=(n,e,t)=>{let r=[],i=me(t.keys()).sort((u,p)=>u-p);if(i.length===0)return null;let s=()=>{if(i.length===0)return null;let u=t.get(i[i.length-1]);for(;u.refs.length===u.i;)if(i.pop(),i.length>0)u=t.get(i[i.length-1]);else return null;return u},o=s();if(o===null)return null;let l=new Cr,c=new Map,a=(u,p)=>{let g=c.get(u);(g==null||g>p)&&c.set(u,p)},h=o.refs[o.i++],d=new Map,f=()=>{for(let u of r){let p=u.id.client,g=t.get(p);g?(g.i--,l.clients.set(p,g.refs.slice(g.i)),t.delete(p),g.i=0,g.refs=[]):l.clients.set(p,[u]),i=i.filter(x=>x!==p)}r.length=0};for(;;){if(h.constructor!==q){let p=F(d,h.id.client,()=>A(e,h.id.client))-h.id.clock;if(p<0)r.push(h),a(h.id.client,h.id.clock-1),f();else{let g=h.getMissing(n,e);if(g!==null){r.push(h);let x=t.get(g)||{refs:[],i:0};if(x.refs.length===x.i)a(g,A(e,g)),f();else{h=x.refs[x.i++];continue}}else(p===0||p<h.length)&&(h.integrate(n,p),d.set(h.id.client,h.id.clock+h.length))}}if(r.length>0)h=r.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=s(),o===null)break;h=o.refs[o.i++]}}if(l.clients.size>0){let u=new se;return Xi(u,l,new Map),m(u.restEncoder,0),{missing:c,update:u.toUint8Array()}}return null},Lh=(n,e)=>Xi(n,e.doc.store,e.beforeState),Qi=(n,e,t,r=new $(n))=>D(e,i=>{i.local=!1;let s=!1,o=i.doc,l=o.store,c=Ph(r,o),a=Fh(i,l,c),h=l.pendingStructs;if(h){for(let[f,u]of h.missing)if(u<A(l,f)){s=!0;break}if(a){for(let[f,u]of a.missing){let p=h.missing.get(f);(p==null||p>u)&&h.missing.set(f,u)}h.update=Dn([h.update,a.update])}}else l.pendingStructs=a;let d=tl(r,i,l);if(l.pendingDs){let f=new $(R(l.pendingDs));y(f.restDecoder);let u=tl(f,i,l);d&&u?l.pendingDs=Dn([d,u]):l.pendingDs=d||u}else l.pendingDs=d;if(s){let f=l.pendingStructs.update;l.pendingStructs=null,_r(i.doc,f)}},t,!1),vh=(n,e,t)=>Qi(n,e,t,new Q(n)),_r=(n,e,t,r=$)=>{let i=R(e);Qi(i,n,t,new r(i))},Zi=(n,e,t)=>_r(n,e,t,Q),zh=(n,e,t=new Map)=>{Xi(n,e.store,t),Ce(n,Gi(e.store))},xl=(n,e=new Uint8Array([0]),t=new se)=>{let r=ts(e);zh(t,n,r);let i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(os(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===Te)return Il(i.map((s,o)=>o===0?s:Bl(s)));if(t.constructor===se)return Dn(i)}return i[0]},es=(n,e)=>xl(n,e,new Te),Sl=n=>{let e=new Map,t=y(n.restDecoder);for(let r=0;r<t;r++){let i=y(n.restDecoder),s=y(n.restDecoder);e.set(i,s)}return e},ts=n=>Sl(new lt(R(n))),ns=(n,e)=>(m(n.restEncoder,e.size),me(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{m(n.restEncoder,t),m(n.restEncoder,r)}),n),Jh=(n,e)=>ns(n,Rn(e.store)),qh=(n,e=new Wt)=>(n instanceof Map?ns(e,n):Jh(e,n),e.toUint8Array()),rs=n=>qh(n,new He),zi=class{constructor(){this.l=[]}},nl=()=>new zi,rl=(n,e)=>n.l.push(e),il=(n,e)=>{let t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},bl=(n,e,t)=>yn(n.l,[e,t]),_e=class{constructor(e,t){this.client=e,this.clock=t}},ot=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,w=(n,e)=>new _e(n,e),sl=(n,e)=>{m(n,e.client),m(n,e.clock)},ol=n=>w(y(n),y(n)),mt=n=>{for(let[e,t]of n.doc.share.entries())if(t===n)return e;throw J()},ct=(n,e)=>{for(;e!==null;){if(e.parent===n)return!0;e=e.parent._item}return!1},Yh=n=>{let e=[],t=n._start;for(;t;)e.push(t),t=t.right;console.log("Children: ",e),console.log("Children content: ",e.filter(r=>!r.deleted).map(r=>r.content))},Ji=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let i=(s,o)=>{let l=s.get("ds"),c=s.get("ids"),a=h=>this.clients.set(h,o);l.observe(h=>{h.changes.added.forEach(d=>{d.content.getContent().forEach(f=>{f instanceof Uint8Array&&this.dss.set(o,Yt([this.dss.get(o)||jt(),Ue(new lt(R(f)))]))})})}),this.dss.set(o,Yt(l.map(h=>Ue(new lt(R(h)))))),c.observe(h=>h.changes.added.forEach(d=>d.content.getContent().forEach(a))),c.forEach(a)};t.observe(s=>{s.keysChanged.forEach(o=>i(t.get(o),o))}),t.forEach(i)}setUserMapping(e,t,r,{filter:i=()=>!0}={}){let s=this.yusers,o=s.get(r);o||(o=new ft,o.set("ids",new dt),o.set("ds",new dt),s.set(r,o)),o.get("ids").push([t]),s.observe(l=>{setTimeout(()=>{let c=s.get(r);if(c!==o){o=c,this.clients.forEach((d,f)=>{r===d&&o.get("ids").push([f])});let a=new He,h=this.dss.get(r);h&&(Ce(a,h),o.get("ds").push([a.toUint8Array()]))}},0)}),e.on("afterTransaction",l=>{setTimeout(()=>{let c=o.get("ds"),a=l.deleteSet;if(l.local&&a.clients.size>0&&i(l,a)){let h=new He;Ce(h,a),c.push([h.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Be(r,e))return t;return null}},Ee=class{constructor(e,t,r,i=0){this.type=e,this.tname=t,this.item=r,this.assoc=i}},Wh=n=>{let e={};return n.type&&(e.type=n.type),n.tname&&(e.tname=n.tname),n.item&&(e.item=n.item),n.assoc!=null&&(e.assoc=n.assoc),e},gt=n=>new Ee(n.type==null?null:w(n.type.client,n.type.clock),n.tname||null,n.item==null?null:w(n.item.client,n.item.clock),n.assoc==null?0:n.assoc),kr=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},Hh=(n,e,t=0)=>new kr(n,e,t),gr=(n,e,t)=>{let r=null,i=null;return n._item===null?i=mt(n):r=w(n._item.id.client,n._item.id.clock),new Ee(r,i,e,t)},_n=(n,e,t=0)=>{let r=n._start;if(t<0){if(e===0)return gr(n,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return gr(n,w(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return gr(n,r.lastId,t);r=r.right}return gr(n,null,t)},Kh=(n,e)=>{let{type:t,tname:r,item:i,assoc:s}=e;if(i!==null)m(n,0),sl(n,i);else if(r!==null)Vt(n,1),ye(n,r);else if(t!==null)Vt(n,2),sl(n,t);else throw J();return fn(n,s),n},jh=n=>{let e=U();return Kh(e,n),E(e)},$h=n=>{let e=null,t=null,r=null;switch(y(n)){case 0:r=ol(n);break;case 1:t=he(n);break;case 2:e=ol(n)}let i=xi(n)?pn(n):0;return new Ee(e,t,r,i)},Gh=n=>$h(R(n)),is=(n,e)=>{let t=e.store,r=n.item,i=n.type,s=n.tname,o=n.assoc,l=null,c=0;if(r!==null){if(A(t,r.client)<=r.clock)return null;let a=Ki(t,r),h=a.item;if(!(h instanceof C))return null;if(l=h.parent,l._item===null||!l._item.deleted){c=h.deleted||!h.countable?0:a.diff+(o>=0?0:1);let d=h.left;for(;d!==null;)!d.deleted&&d.countable&&(c+=d.length),d=d.left}}else{if(s!==null)l=e.get(s);else if(i!==null){if(A(t,i.client)<=i.clock)return null;let{item:a}=Ki(t,i);if(a instanceof C&&a.content instanceof Z)l=a.content.type;else return null}else throw J();o>=0?c=l._length:c=0}return Hh(l,c,n.assoc)},Ur=(n,e)=>n===e||n!==null&&e!==null&&n.tname===e.tname&&ot(n.item,e.item)&&ot(n.type,e.type)&&n.assoc===e.assoc,Ke=class{constructor(e,t){this.ds=e,this.sv=t}},Xh=(n,e)=>{let t=n.ds.clients,r=e.ds.clients,i=n.sv,s=e.sv;if(i.size!==s.size||t.size!==r.size)return!1;for(let[o,l]of i.entries())if(s.get(o)!==l)return!1;for(let[o,l]of t.entries()){let c=r.get(o)||[];if(l.length!==c.length)return!1;for(let a=0;a<l.length;a++){let h=l[a],d=c[a];if(h.clock!==d.clock||h.len!==d.len)return!1}}return!0},kl=(n,e=new Wt)=>(Ce(e,n.ds),ns(e,n.sv),e.toUint8Array()),Qh=n=>kl(n,new He),Cl=(n,e=new br(R(n)))=>new Ke(Ue(e),Sl(e)),Zh=n=>Cl(n,new lt(R(n))),Un=(n,e)=>new Ke(n,e),ed=Un(jt(),new Map),ss=n=>Un(Gi(n.store),Rn(n.store)),Je=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!Be(e.ds,n.id),qi=(n,e)=>{let t=F(n.meta,qi,te),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<A(r,s)&&j(n,w(s,i))}),ke(n,e.ds,i=>{}),t.add(e))},td=(n,e,t=new Re)=>{if(n.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:r,ds:i}=e,s=new se;return n.transact(o=>{let l=0;r.forEach(c=>{c>0&&l++}),m(s.restEncoder,l);for(let[c,a]of r){if(a===0)continue;a<A(n.store,c)&&j(o,w(c,a));let h=n.store.clients.get(c)||[],d=de(h,a-1);m(s.restEncoder,d+1),s.writeClient(c),m(s.restEncoder,0);for(let f=0;f<=d;f++)h[f].write(s,0)}Ce(s,i)}),_r(t,s.toUint8Array(),"snapshot"),t},nd=(n,e,t=$)=>{let r=new t(R(e)),i=new De(r,!1);for(let o=i.curr;o!==null;o=i.next())if((n.sv.get(o.id.client)||0)<o.id.clock+o.length)return!1;let s=Yt([n.ds,Ue(r)]);return yl(n.ds,s)},rd=(n,e)=>nd(n,e,Q),Cr=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Rn=n=>{let e=new Map;return n.clients.forEach((t,r)=>{let i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},A=(n,e)=>{let t=n.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Tl=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw J()}t.push(e)},de=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=H(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=H((t+r)/2)}throw J()},id=(n,e)=>{let t=n.clients.get(e.client);return t[de(t,e.clock)]},bn=id,Yi=(n,e,t)=>{let r=de(e,t),i=e[r];return i.id.clock<t&&i instanceof C?(e.splice(r+1,0,Ir(n,i,t-i.id.clock)),r+1):r},j=(n,e)=>{let t=n.doc.store.clients.get(e.client);return t[Yi(n,t,e.clock)]},ll=(n,e,t)=>{let r=e.clients.get(t.client),i=de(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==K&&r.splice(i+1,0,Ir(n,s,t.clock-s.id.clock+1)),s},sd=(n,e,t)=>{let r=n.clients.get(e.id.client);r[de(r,e.id.clock)]=t},El=(n,e,t,r,i)=>{if(r===0)return;let s=t+r,o=Yi(n,e,t),l;do l=e[o++],s<l.id.clock+l.length&&Yi(n,e,s),i(l);while(o<e.length&&e[o].id.clock<s)},Tr=class{constructor(e,t,r){this.doc=e,this.deleteSet=new We,this.beforeState=Rn(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},cl=(n,e)=>e.deleteSet.clients.size===0&&!oo(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:($i(e.deleteSet),Lh(n,e),Ce(n,e.deleteSet),!0),al=(n,e,t)=>{let r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&F(n.changed,e,te).add(t)},xr=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof C&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-i;return s&&n.splice(e+1-s,s),s},Dl=(n,e,t)=>{for(let[r,i]of n.clients.entries()){let s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){let l=i[o],c=l.clock+l.len;for(let a=de(s,l.clock),h=s[a];a<s.length&&h.id.clock<c;h=s[++a]){let d=s[a];if(l.clock+l.len<=d.id.clock)break;d instanceof C&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},Ol=(n,e)=>{n.clients.forEach((t,r)=>{let i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let o=t[s],l=ne(i.length-1,1+de(i,o.clock+o.len-1));for(let c=l,a=i[c];c>0&&a.id.clock>=o.clock;a=i[c])c-=1+xr(i,c)}})},od=(n,e,t)=>{Dl(n,e,t),Ol(n,e)},Ml=(n,e)=>{if(e<n.length){let t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{$i(s),t.afterState=Rn(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let l=[];t.changed.forEach((c,a)=>l.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(t,c)})),l.push(()=>{t.changedParentTypes.forEach((c,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(c=c.filter(h=>h.target._item===null||!h.target._item.deleted),c.forEach(h=>{h.currentTarget=a,h._path=null}),c.sort((h,d)=>h.path.length-d.path.length),bl(a._dEH,c,t))})}),l.push(()=>r.emit("afterTransaction",[t,r])),yn(l,[]),t._needFormattingCleanup&&Od(t)}finally{r.gc&&Dl(s,i,r.gcFilter),Ol(s,i),t.afterState.forEach((h,d)=>{let f=t.beforeState.get(d)||0;if(f!==h){let u=i.clients.get(d),p=ce(de(u,f),1);for(let g=u.length-1;g>=p;)g-=1+xr(u,g)}});for(let h=o.length-1;h>=0;h--){let{client:d,clock:f}=o[h].id,u=i.clients.get(d),p=de(u,f);p+1<u.length&&xr(u,p+1)>1||p>0&&xr(u,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(pr(qt,wn,"[yjs] ",xn,Sn,"Changed the client-id because another client seems to be using it."),r.clientID=wl()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let h=new Te;cl(h,t)&&r.emit("update",[h.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let h=new se;cl(h,t)&&r.emit("updateV2",[h.toUint8Array(),t.origin,r,t])}let{subdocsAdded:l,subdocsLoaded:c,subdocsRemoved:a}=t;(l.size>0||a.size>0||c.size>0)&&(l.forEach(h=>{h.clientID=r.clientID,h.collectionid==null&&(h.collectionid=r.collectionid),r.subdocs.add(h)}),a.forEach(h=>r.subdocs.delete(h)),r.emit("subdocs",[{loaded:c,added:l,removed:a},r,t]),a.forEach(h=>h.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):Ml(n,e+1)}}},D=(n,e,t=null,r=!0)=>{let i=n._transactionCleanups,s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new Tr(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){let l=n._transaction===i[0];n._transaction=null,l&&Ml(i,0)}}return o},Wi=class{constructor(e,t){this.insertions=t,this.deletions=e,this.meta=new Map}},hl=(n,e,t)=>{ke(n,t.deletions,r=>{r instanceof C&&e.scope.some(i=>ct(i,r))&&ds(r,!1)})},dl=(n,e,t)=>{let r=null,i=null,s=n.doc,o=n.scope;if(D(s,l=>{for(;e.length>0&&r===null;){let c=s.store,a=e.pop(),h=new Set,d=[],f=!1;ke(l,a.insertions,u=>{if(u instanceof C){if(u.redone!==null){let{item:p,diff:g}=Ki(c,u.id);g>0&&(p=j(l,w(p.id.client,p.id.clock+g))),u=p}!u.deleted&&o.some(p=>ct(p,u))&&d.push(u)}}),ke(l,a.deletions,u=>{u instanceof C&&o.some(p=>ct(p,u))&&!Be(a.insertions,u.id)&&h.add(u)}),h.forEach(u=>{f=tc(l,u,h,a.insertions,n.ignoreRemoteMapChanges,n)!==null||f});for(let u=d.length-1;u>=0;u--){let p=d[u];n.deleteFilter(p)&&(p.delete(l),f=!0)}r=f?a:null}l.changed.forEach((c,a)=>{c.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),i=l},n),r!=null){let l=i.changedParentTypes;n.emit("stack-item-popped",[{stackItem:r,type:t,changedParentTypes:l},n])}return r},at=class extends ge{constructor(e,{captureTimeout:t=500,captureTransaction:r=c=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:l=an(e)?e[0].doc:e.doc}={}){super(),this.scope=[],this.doc=l,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=t,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(x=>c.changedParentTypes.has(x))||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;let a=this.undoing,h=this.redoing,d=a?this.redoStack:this.undoStack;a?this.stopCapturing():h||this.clear(!1,!0);let f=new We;c.afterState.forEach((x,S)=>{let ue=c.beforeState.get(S)||0,Ne=x-ue;Ne>0&&Tn(f,S,ue,Ne)});let u=ie(),p=!1;if(this.lastChange>0&&u-this.lastChange<this.captureTimeout&&d.length>0&&!a&&!h){let x=d[d.length-1];x.deletions=Yt([x.deletions,c.deleteSet]),x.insertions=Yt([x.insertions,f])}else d.push(new Wi(c.deleteSet,f)),p=!0;!a&&!h&&(this.lastChange=u),ke(c,c.deleteSet,x=>{x instanceof C&&this.scope.some(S=>ct(S,x))&&ds(x,!0)});let g=[{stackItem:d[d.length-1],origin:c.origin,type:a?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",g):this.emit("stack-item-updated",g)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){e=an(e)?e:[e],e.forEach(t=>{this.scope.every(r=>r!==t)&&(t.doc!==this.doc&&$o("[yjs#509] Not same Y.Doc"),this.scope.push(t))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>hl(r,this,i)),this.undoStack=[]),t&&(this.redoStack.forEach(i=>hl(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=dl(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=dl(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*ld(n){let e=y(n.restDecoder);for(let t=0;t<e;t++){let r=y(n.restDecoder),i=n.readClient(),s=y(n.restDecoder);for(let o=0;o<r;o++){let l=n.readInfo();if(l===10){let c=y(n.restDecoder);yield new q(w(i,s),c),s+=c}else if(31&l){let c=(l&192)===0,a=new C(w(i,s),null,(l&128)===128?n.readLeftID():null,null,(l&64)===64?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(l&32)===32?n.readString():null,nc(n,l));yield a,s+=a.length}else{let c=n.readLen();yield new K(w(i,s),c),s+=c}}}}var De=class{constructor(e,t){this.gen=ld(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===q);return this.curr}},cd=n=>Nl(n,Q),Nl=(n,e=$)=>{let t=[],r=new e(R(n)),i=new De(r,!1);for(let o=i.curr;o!==null;o=i.next())t.push(o);pr("Structs: ",t);let s=Ue(r);pr("DeleteSet: ",s)},ad=n=>Al(n,Q),Al=(n,e=$)=>{let t=[],r=new e(R(n)),i=new De(r,!1);for(let s=i.curr;s!==null;s=i.next())t.push(s);return{structs:t,ds:Ue(r)}},En=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Il=n=>Dn(n,Q,Te),_l=(n,e=Wt,t=$)=>{let r=new e,i=new De(new t(R(n)),!1),s=i.curr;if(s!==null){let o=0,l=s.id.client,c=s.id.clock!==0,a=c?0:s.id.clock+s.length;for(;s!==null;s=i.next())l!==s.id.client&&(a!==0&&(o++,m(r.restEncoder,l),m(r.restEncoder,a)),l=s.id.client,a=0,c=s.id.clock!==0),s.constructor===q&&(c=!0),c||(a=s.id.clock+s.length);a!==0&&(o++,m(r.restEncoder,l),m(r.restEncoder,a));let h=U();return m(h,o),So(h,r.restEncoder),r.restEncoder=h,r.toUint8Array()}else return m(r.restEncoder,0),r.toUint8Array()},hd=n=>_l(n,He,Q),Ul=(n,e=$)=>{let t=new Map,r=new Map,i=new De(new e(R(n)),!1),s=i.curr;if(s!==null){let o=s.id.client,l=s.id.clock;for(t.set(o,l);s!==null;s=i.next())o!==s.id.client&&(r.set(o,l),t.set(s.id.client,s.id.clock),o=s.id.client),l=s.id.clock+s.length;r.set(o,l)}return{from:t,to:r}},dd=n=>Ul(n,Q),fd=(n,e)=>{if(n.constructor===K){let{client:t,clock:r}=n.id;return new K(w(t,r+e),n.length-e)}else if(n.constructor===q){let{client:t,clock:r}=n.id;return new q(w(t,r+e),n.length-e)}else{let t=n,{client:r,clock:i}=t.id;return new C(w(r,i+e),null,w(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Dn=(n,e=$,t=se)=>{if(n.length===1)return n[0];let r=n.map(h=>new e(R(h))),i=r.map(h=>new De(h,!0)),s=null,o=new t,l=new En(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,u)=>{if(f.curr.id.client===u.curr.id.client){let p=f.curr.id.clock-u.curr.id.clock;return p===0?f.curr.constructor===u.curr.constructor?0:f.curr.constructor===q?1:-1:p}else return u.curr.id.client-f.curr.id.client}),i.length!==0;){let h=i[0],d=h.curr.id.client;if(s!==null){let f=h.curr,u=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=h.next(),u=!0;if(f===null||f.id.client!==d||u&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)qe(l,s.struct,s.offset),s={struct:f,offset:0},h.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===q)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{qe(l,s.struct,s.offset);let p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new q(w(d,s.struct.id.clock+s.struct.length),p),offset:0}}else{let p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===q?s.struct.length-=p:f=fd(f,p)),s.struct.mergeWith(f)||(qe(l,s.struct,s.offset),s={struct:f,offset:0},h.next())}}else s={struct:h.curr,offset:0},h.next();for(let f=h.curr;f!==null&&f.id.client===d&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==q;f=h.next())qe(l,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(qe(l,s.struct,s.offset),s=null),ls(l);let c=r.map(h=>Ue(h)),a=Yt(c);return Ce(o,a),o.toUint8Array()},os=(n,e,t=$,r=se)=>{let i=ts(e),s=new r,o=new En(s),l=new t(R(n)),c=new De(l,!1);for(;c.curr;){let h=c.curr,d=h.id.client,f=i.get(d)||0;if(c.curr.constructor===q){c.next();continue}if(h.id.clock+h.length>f)for(qe(o,h,ce(f-h.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)qe(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=f;)c.next()}ls(o);let a=Ue(l);return Ce(s,a),s.toUint8Array()},ud=(n,e)=>os(n,e,Q,Te),Rl=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:E(n.encoder.restEncoder)}),n.encoder.restEncoder=U(),n.written=0)},qe=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&Rl(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),m(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},ls=n=>{Rl(n);let e=n.encoder.restEncoder;m(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){let r=n.clientStructs[t];m(e,r.written),Bt(e,r.restEncoder)}},Rr=(n,e,t,r)=>{let i=new t(R(n)),s=new De(i,!1),o=new r,l=new En(o);for(let a=s.curr;a!==null;a=s.next())qe(l,e(a),0);ls(l);let c=Ue(i);return Ce(o,c),o.toUint8Array()},Vl=({formatting:n=!0,subdocs:e=!0,yxml:t=!0}={})=>{let r=0,i=_(),s=_(),o=_(),l=_();return l.set(null,null),c=>{switch(c.constructor){case K:case q:return c;case C:{let a=c,h=a.content;switch(h.constructor){case Kt:break;case Z:{if(t){let d=h.type;d instanceof Y&&(d.nodeName=F(s,d.nodeName,()=>"node-"+r)),d instanceof An&&(d.hookName=F(s,d.hookName,()=>"hook-"+r))}break}case $e:{let d=h;d.arr=d.arr.map(()=>r);break}case ut:{let d=h;d.content=new Uint8Array([r]);break}case pt:{let d=h;e&&(d.opts={},d.doc.guid=r+"");break}case Ve:{let d=h;d.embed={};break}case I:{let d=h;n&&(d.key=F(o,d.key,()=>r+""),d.value=F(l,d.value,()=>({i:r})));break}case In:{let d=h;d.arr=d.arr.map(()=>r);break}case oe:{let d=h;d.str=mo(r%10+"",d.str.length);break}default:J()}return a.parentSub&&(a.parentSub=F(i,a.parentSub,()=>r+"")),r++,c}default:J()}}},pd=(n,e)=>Rr(n,Vl(e),Q,Te),md=(n,e)=>Rr(n,Vl(e),$,se),gd=n=>Rr(n,Ni,Q,se),Bl=n=>Rr(n,Ni,$,Te),fl="You must not compute changes after the event-handler fired.",ht=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=yd(this.currentTarget,this.target))}deletes(e){return Be(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw we(fl);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){let s=t._map.get(i),o,l;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",l=tr(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",l=tr(c.content.getContent())):(o="add",l=void 0)}else if(this.deletes(s))o="delete",l=tr(s.content.getContent());else return;e.set(i,{action:o,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw we(fl);let t=this.target,r=te(),i=te(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let l=null,c=()=>{l&&s.push(l)};for(let a=t._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((l===null||l.delete===void 0)&&(c(),l={delete:0}),l.delete+=a.length,i.add(a)):this.adds(a)?((l===null||l.insert===void 0)&&(c(),l={insert:[]}),l.insert=l.insert.concat(a.content.getContent()),r.add(a)):((l===null||l.retain===void 0)&&(c(),l={retain:0}),l.retain+=a.length);l!==null&&l.retain===void 0&&c()}this._changes=e}return e}},yd=(n,e)=>{let t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)i.deleted||r++,i=i.right;t.unshift(r)}e=e._item.parent}return t},Pl=80,cs=0,Hi=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=cs++}},wd=n=>{n.timestamp=cs++},Fl=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=cs++},xd=(n,e,t)=>{if(n.length>=Pl){let r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Fl(r,e,t),r}else{let r=new Hi(e,t);return n.push(r),r}},Vr=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;let t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Nt(e-s.index)<Nt(e-o.index)?s:o),r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,wd(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Nt(t.index-i)<r.parent.length/Pl?(Fl(t,r,i),t):xd(n._searchMarker,r,i)},On=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){let i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=ce(e,i.index+t))}},Sd=n=>{let e=n._start,t=[];for(;e;)t.push(e),e=e.right;return t},Br=(n,e,t)=>{let r=n,i=e.changedParentTypes;for(;F(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;bl(r._eH,t,e)},B=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=nl(),this._dEH=nl(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw re()}clone(){throw re()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){rl(this._eH,e)}observeDeep(e){rl(this._dEH,e)}unobserve(e){il(this._eH,e)}unobserveDeep(e){il(this._dEH,e)}toJSON(){}},Ll=(n,e,t)=>{e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e,i=[],s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let l=e;l<o.length&&r>0;l++)i.push(o[l]),r--;e=0}}s=s.right}return i},vl=n=>{let e=[],t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},Pr=(n,e)=>{let t=[],r=n._start;for(;r!==null;){if(r.countable&&Je(r,e)){let i=r.content.getContent();for(let s=0;s<i.length;s++)t.push(i[s])}r=r.right}return t},Mn=(n,e)=>{let t=0,r=n._start;for(;r!==null;){if(r.countable&&!r.deleted){let i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},zl=(n,e)=>{let t=[];return Mn(n,(r,i)=>{t.push(e(r,i,n))}),t},bd=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},Jl=(n,e)=>{let t=Vr(n,e),r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Er=(n,e,t,r)=>{let i=t,s=n.doc,o=s.clientID,l=s.store,c=t===null?e._start:t.right,a=[],h=()=>{a.length>0&&(i=new C(w(o,A(l,o)),i,i&&i.lastId,c,c&&c.id,e,null,new $e(a)),i.integrate(n,0),a=[])};r.forEach(d=>{if(d===null)a.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(d);break;default:switch(h(),d.constructor){case Uint8Array:case ArrayBuffer:i=new C(w(o,A(l,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ut(new Uint8Array(d))),i.integrate(n,0);break;case Re:i=new C(w(o,A(l,o)),i,i&&i.lastId,c,c&&c.id,e,null,new pt(d)),i.integrate(n,0);break;default:if(d instanceof B)i=new C(w(o,A(l,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Z(d)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},ql=()=>we("Length exceeded!"),Yl=(n,e,t,r)=>{if(t>e._length)throw ql();if(t===0)return e._searchMarker&&On(e._searchMarker,t,r.length),Er(n,e,null,r);let i=t,s=Vr(e,t),o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&j(n,w(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&On(e._searchMarker,i,r.length),Er(n,e,o,r)},kd=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Er(n,e,i,t)},Wl=(n,e,t,r)=>{if(r===0)return;let i=t,s=r,o=Vr(e,t),l=e._start;for(o!==null&&(l=o.p,t-=o.index);l!==null&&t>0;l=l.right)!l.deleted&&l.countable&&(t<l.length&&j(n,w(l.id.client,l.id.clock+t)),t-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&j(n,w(l.id.client,l.id.clock+r)),l.delete(n),r-=l.length),l=l.right;if(r>0)throw ql();e._searchMarker&&On(e._searchMarker,i,-s+r)},Dr=(n,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(n)},as=(n,e,t,r)=>{let i=e._map.get(t)||null,s=n.doc,o=s.clientID,l;if(r==null)l=new $e([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:l=new $e([r]);break;case Uint8Array:l=new ut(r);break;case Re:l=new pt(r);break;default:if(r instanceof B)l=new Z(r);else throw new Error("Unexpected content type")}new C(w(o,A(s.store,o)),i,i&&i.lastId,null,null,e,t,l).integrate(n,0)},hs=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Hl=n=>{let e={};return n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Kl=(n,e)=>{let t=n._map.get(e);return t!==void 0&&!t.deleted},Cd=(n,e,t)=>{let r=n._map.get(e)||null;for(;r!==null&&(!t.sv.has(r.id.client)||r.id.clock>=(t.sv.get(r.id.client)||0));)r=r.left;return r!==null&&Je(r,t)?r.content.getContent()[r.length-1]:void 0},jl=(n,e)=>{let t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Je(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},yr=n=>Qo(n.entries(),e=>!e[1].deleted),Or=class extends ht{constructor(e,t){super(e,t),this._transaction=t}},dt=class n extends B{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new n;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return e.insert(0,this.toArray().map(t=>t instanceof B?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Br(this,e,new Or(this,e))}insert(e,t){this.doc!==null?D(this.doc,r=>{Yl(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?D(this.doc,t=>{kd(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?D(this.doc,r=>{Wl(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Jl(this,e)}toArray(){return vl(this)}slice(e=0,t=this.length){return Ll(this,e,t)}toJSON(){return this.map(e=>e instanceof B?e.toJSON():e)}map(e){return zl(this,e)}forEach(e){Mn(this,e)}[Symbol.iterator](){return bd(this)}_write(e){e.writeTypeRef(qd)}},Td=n=>new dt,Mr=class extends ht{constructor(e,t,r){super(e,t),this.keysChanged=r}},ft=class n extends B{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return this.forEach((t,r)=>{e.set(r,t instanceof B?t.clone():t)}),e}_callObserver(e,t){Br(this,e,new Mr(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let i=t.content.getContent()[t.length-1];e[r]=i instanceof B?i.toJSON():i}}),e}get size(){return[...yr(this._map)].length}keys(){return mr(yr(this._map),e=>e[0])}values(){return mr(yr(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return mr(yr(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?D(this.doc,t=>{Dr(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?D(this.doc,r=>{as(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return hs(this,e)}has(e){return Kl(this,e)}clear(){this.doc!==null?D(this.doc,e=>{this.forEach(function(t,r,i){Dr(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Yd)}},Ed=n=>new ft,Ye=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&Mi(n,e),Nn=class{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&J(),this.right.content.constructor){case I:this.right.deleted||$t(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},ul=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case I:e.right.deleted||$t(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&j(n,w(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},wr=(n,e,t)=>{let r=new Map,i=Vr(e,t);if(i){let s=new Nn(i.p.left,i.p,i.index,r);return ul(n,s,t-i.index)}else{let s=new Nn(null,e._start,0,r);return ul(n,s,t)}},$l=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===I&&Ye(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let i=n.doc,s=i.clientID;r.forEach((o,l)=>{let c=t.left,a=t.right,h=new C(w(s,A(i.store,s)),c,c&&c.lastId,a,a&&a.id,e,null,new I(l,o));h.integrate(n,0),t.right=h,t.forward()})},$t=(n,e)=>{let{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},Gl=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===I&&Ye(e[n.right.content.key]||null,n.right.content.value)))break;n.forward()}},Xl=(n,e,t,r)=>{let i=n.doc,s=i.clientID,o=new Map;for(let l in r){let c=r[l],a=t.currentAttributes.get(l)||null;if(!Ye(a,c)){o.set(l,a);let{left:h,right:d}=t;t.right=new C(w(s,A(i.store,s)),h,h&&h.lastId,d,d&&d.id,e,null,new I(l,c)),t.right.integrate(n,0),t.forward()}}return o},Li=(n,e,t,r,i)=>{t.currentAttributes.forEach((f,u)=>{i[u]===void 0&&(i[u]=null)});let s=n.doc,o=s.clientID;Gl(t,i);let l=Xl(n,e,t,i),c=r.constructor===String?new oe(r):r instanceof B?new Z(r):new Ve(r),{left:a,right:h,index:d}=t;e._searchMarker&&On(e._searchMarker,t.index,c.getLength()),h=new C(w(o,A(s.store,o)),a,a&&a.lastId,h,h&&h.id,e,null,c),h.integrate(n,0),t.right=h,t.index=d,t.forward(),$l(n,e,t,l)},pl=(n,e,t,r,i)=>{let s=n.doc,o=s.clientID;Gl(t,i);let l=Xl(n,e,t,i);e:for(;t.right!==null&&(r>0||l.size>0&&(t.right.deleted||t.right.content.constructor===I));){if(!t.right.deleted)switch(t.right.content.constructor){case I:{let{key:c,value:a}=t.right.content,h=i[c];if(h!==void 0){if(Ye(h,a))l.delete(c);else{if(r===0)break e;l.set(c,a)}t.right.delete(n)}else t.currentAttributes.set(c,a);break}default:r<t.right.length&&j(n,w(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new C(w(o,A(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new oe(c)),t.right.integrate(n,0),t.forward()}$l(n,e,t,l)},Ql=(n,e,t,r,i)=>{let s=e,o=_();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===I){let a=s.content;o.set(a.key,a)}s=s.right}let l=0,c=!1;for(;e!==s;){if(t===e&&(c=!0),!e.deleted){let a=e.content;switch(a.constructor){case I:{let{key:h,value:d}=a,f=r.get(h)||null;(o.get(h)!==a||f===d)&&(e.delete(n),l++,!c&&(i.get(h)||null)===d&&f!==d&&(f===null?i.delete(h):i.set(h,f))),!c&&!e.deleted&&$t(i,a);break}}}e=e.right}return l},Dd=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===I){let r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},Zl=n=>{let e=0;return D(n.doc,t=>{let r=n._start,i=n._start,s=_(),o=er(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case I:$t(o,i.content);break;default:e+=Ql(t,r,i,s,o),s=er(o),r=i;break}i=i.right}}),e},Od=n=>{let e=new Set,t=n.doc;for(let[r,i]of n.afterState.entries()){let s=n.beforeState.get(r)||0;i!==s&&El(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===I&&o.constructor!==K&&e.add(o.parent)})}D(t,r=>{ke(n,n.deleteSet,i=>{if(i instanceof K||!i.parent._hasFormatting||e.has(i.parent))return;let s=i.parent;i.content.constructor===I?e.add(s):Dd(r,i)});for(let i of e)Zl(i)})},ml=(n,e,t)=>{let r=t,i=er(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Z:case Ve:case oe:t<e.right.length&&j(n,w(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&Ql(n,s,e.right,i,e.currentAttributes);let o=(e.left||e.right).parent;return o._searchMarker&&On(o._searchMarker,e.index,-r+t),e},Nr=class extends ht{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];D(e,r=>{let i=new Map,s=new Map,o=this.target._start,l=null,c={},a="",h=0,d=0,f=()=>{if(l!==null){let u=null;switch(l){case"delete":d>0&&(u={delete:d}),d=0;break;case"insert":(typeof a=="object"||a.length>0)&&(u={insert:a},i.size>0&&(u.attributes={},i.forEach((p,g)=>{p!==null&&(u.attributes[g]=p)}))),a="";break;case"retain":h>0&&(u={retain:h},Ro(c)||(u.attributes=Io({},c))),h=0;break}u&&t.push(u),l=null}};for(;o!==null;){switch(o.content.constructor){case Z:case Ve:this.adds(o)?this.deletes(o)||(f(),l="insert",a=o.content.getContent()[0],f()):this.deletes(o)?(l!=="delete"&&(f(),l="delete"),d+=1):o.deleted||(l!=="retain"&&(f(),l="retain"),h+=1);break;case oe:this.adds(o)?this.deletes(o)||(l!=="insert"&&(f(),l="insert"),a+=o.content.str):this.deletes(o)?(l!=="delete"&&(f(),l="delete"),d+=o.length):o.deleted||(l!=="retain"&&(f(),l="retain"),h+=o.length);break;case I:{let{key:u,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){let g=i.get(u)||null;Ye(g,p)?p!==null&&o.delete(r):(l==="retain"&&f(),Ye(p,s.get(u)||null)?delete c[u]:c[u]=p)}}else if(this.deletes(o)){s.set(u,p);let g=i.get(u)||null;Ye(g,p)||(l==="retain"&&f(),c[u]=g)}else if(!o.deleted){s.set(u,p);let g=c[u];g!==void 0&&(Ye(g,p)?g!==null&&o.delete(r):(l==="retain"&&f(),p===null?delete c[u]:c[u]=p))}o.deleted||(l==="insert"&&f(),$t(i,o.content));break}}o=o.right}for(f();t.length>0;){let u=t[t.length-1];if(u.retain!==void 0&&u.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},je=class n extends B{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new n}clone(){let e=new n;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Nr(this,e,t);Br(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===oe&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?D(this.doc,r=>{let i=new Nn(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let o=e[s];if(o.insert!==void 0){let l=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof l!="string"||l.length>0)&&Li(r,this,i,l,o.attributes||{})}else o.retain!==void 0?pl(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ml(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let i=[],s=new Map,o=this.doc,l="",c=this._start;function a(){if(l.length>0){let d={},f=!1;s.forEach((p,g)=>{f=!0,d[g]=p});let u={insert:l};f&&(u.attributes=d),i.push(u),l=""}}let h=()=>{for(;c!==null;){if(Je(c,e)||t!==void 0&&Je(c,t))switch(c.content.constructor){case oe:{let d=s.get("ychange");e!==void 0&&!Je(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(a(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!Je(c,t)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(a(),s.set("ychange",r?r("added",c.id):{type:"added"})):d!==void 0&&(a(),s.delete("ychange")),l+=c.content.str;break}case Z:case Ve:{a();let d={insert:c.content.getContent()[0]};if(s.size>0){let f={};d.attributes=f,s.forEach((u,p)=>{f[p]=u})}i.push(d);break}case I:Je(c,e)&&(a(),$t(s,c.content));break}c=c.right}a()};return e||t?D(o,d=>{e&&qi(d,e),t&&qi(d,t),h()},"cleanup"):h(),i}insert(e,t,r){if(t.length<=0)return;let i=this.doc;i!==null?D(i,s=>{let o=wr(s,this,e);r||(r={},o.currentAttributes.forEach((l,c)=>{r[c]=l})),Li(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r={}){let i=this.doc;i!==null?D(i,s=>{let o=wr(s,this,e);Li(s,this,o,t,r)}):this._pending.push(()=>this.insertEmbed(e,t,r))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?D(r,i=>{ml(i,wr(i,this,e),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let i=this.doc;i!==null?D(i,s=>{let o=wr(s,this,e);o.right!==null&&pl(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?D(this.doc,t=>{Dr(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?D(this.doc,r=>{as(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return hs(this,e)}getAttributes(){return Hl(this)}_write(e){e.writeTypeRef(Wd)}},Md=n=>new je,kn=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Y||t.constructor===Oe)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Oe=class n extends B{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new n}clone(){let e=new n;return e.insert(0,this.toArray().map(t=>t instanceof B?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new kn(this,e)}querySelector(e){e=e.toUpperCase();let r=new kn(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),me(new kn(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Br(this,e,new Ar(this,t,e))}toString(){return zl(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Mn(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?D(this.doc,r=>{Yl(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)D(this.doc,r=>{let i=e&&e instanceof B?e._item:e;Er(r,this,i,t)});else{let r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw we("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?D(this.doc,r=>{Wl(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return vl(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Jl(this,e)}slice(e=0,t=this.length){return Ll(this,e,t)}forEach(e){Mn(this,e)}_write(e){e.writeTypeRef(Kd)}},Nd=n=>new Oe,Y=class n extends Oe{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new n(this.nodeName)}clone(){let e=new n(this.nodeName),t=this.getAttributes();return _o(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof B?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let l in e)r.push(l);r.sort();let i=r.length;for(let l=0;l<i;l++){let c=r[l];t.push(c+'="'+e[c]+'"')}let s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?D(this.doc,t=>{Dr(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?D(this.doc,r=>{as(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return hs(this,e)}hasAttribute(e){return Kl(this,e)}getAttributes(e){return e?jl(this,e):Hl(this)}toDOM(e=document,t={},r){let i=e.createElement(this.nodeName),s=this.getAttributes();for(let o in s){let l=s[o];typeof l=="string"&&i.setAttribute(o,l)}return Mn(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Hd),e.writeKey(this.nodeName)}},Ad=n=>new Y(n.readKey()),Ar=class extends ht{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}},An=class n extends ft{constructor(e){super(),this.hookName=e}_copy(){return new n(this.hookName)}clone(){let e=new n(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let i=t[this.hookName],s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(jd),e.writeKey(this.hookName)}},Id=n=>new An(n.readKey()),G=class n extends je{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new n}clone(){let e=new n;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{let t=[];for(let i in e.attributes){let s=[];for(let o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,l)=>o.key<l.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){let s=t[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){let l=s.attrs[o];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef($d)}},_d=n=>new G,Ht=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw re()}mergeWith(e){return!1}write(e,t,r){throw re()}integrate(e,t){throw re()}},Ud=0,K=class extends Ht{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Tl(e.doc.store,this)}write(e,t){e.writeInfo(Ud),e.writeLen(this.length-t)}getMissing(e,t){return null}},ut=class n{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new n(this.content)}splice(e){throw re()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},Rd=n=>new ut(n.readBuf()),Kt=class n{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new n(this.len)}splice(e){let t=new n(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Tn(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Vd=n=>new Kt(n.readLen()),ec=(n,e)=>new Re({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),pt=class n{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new n(ec(this.doc.guid,this.opts))}splice(e){throw re()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Bd=n=>new pt(ec(n.readString(),n.readAny())),Ve=class n{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new n(this.embed)}splice(e){throw re()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Pd=n=>new Ve(n.readJSON()),I=class n{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new n(this.key,this.value)}splice(e){throw re()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},Fd=n=>new I(n.readKey(),n.readJSON()),In=class n{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new n(this.arr)}splice(e){let t=new n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){let s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Ld=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++){let i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new In(t)},$e=class n{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new n(this.arr)}splice(e){let t=new n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){let s=this.arr[i];e.writeAny(s)}}getRef(){return 8}},vd=n=>{let e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new $e(t)},oe=class n{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new n(this.str)}splice(e){let t=new n(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},zd=n=>new oe(n.readString()),Jd=[Td,Ed,Md,Ad,Nd,Id,_d],qd=0,Yd=1,Wd=2,Hd=3,Kd=4,jd=5,$d=6,Z=class n{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new n(this.type._copy())}splice(e){throw re()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},Gd=n=>new Z(Jd[n.readTypeRef()](n)),Ki=(n,e)=>{let t=e,r=0,i;do r>0&&(t=w(t.client,t.clock+r)),i=bn(n,t),r=t.clock-i.id.clock,t=i.redone;while(t!==null&&i instanceof C);return{item:i,diff:r}},ds=(n,e)=>{for(;n!==null&&n.keep!==e;)n.keep=e,n=n.parent._item},Ir=(n,e,t)=>{let{client:r,clock:i}=e.id,s=new C(w(r,i+t),e,w(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=w(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s},gl=(n,e)=>co(n,t=>Be(t.deletions,e)),tc=(n,e,t,r,i,s)=>{let o=n.doc,l=o.store,c=o.clientID,a=e.redone;if(a!==null)return j(n,a);let h=e.parent._item,d=null,f;if(h!==null&&h.deleted===!0){if(h.redone===null&&(!t.has(h)||tc(n,h,t,r,i,s)===null))return null;for(;h.redone!==null;)h=j(n,h.redone)}let u=h===null?e.parent:h.content.type;if(e.parentSub===null){for(d=e.left,f=e;d!==null;){let S=d;for(;S!==null&&S.parent._item!==h;)S=S.redone===null?null:j(n,S.redone);if(S!==null&&S.parent._item===h){d=S;break}d=d.left}for(;f!==null;){let S=f;for(;S!==null&&S.parent._item!==h;)S=S.redone===null?null:j(n,S.redone);if(S!==null&&S.parent._item===h){f=S;break}f=f.right}}else if(f=null,e.right&&!i){for(d=e;d!==null&&d.right!==null&&(d.right.redone||Be(r,d.right.id)||gl(s.undoStack,d.right.id)||gl(s.redoStack,d.right.id));)for(d=d.right;d.redone;)d=j(n,d.redone);if(d&&d.right!==null)return null}else d=u._map.get(e.parentSub)||null;let p=A(l,c),g=w(c,p),x=new C(g,d,d&&d.lastId,f,f&&f.id,u,e.parentSub,e.content.copy());return e.redone=g,ds(x,!0),x.integrate(n,0),x},C=class n extends Ht{constructor(e,t,r,i,s,o,l,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=l,this.redone=null,this.content=c,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=A(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=A(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===_e&&this.id.client!==this.parent.client&&this.parent.clock>=A(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ll(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=j(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===K||this.right&&this.right.constructor===K)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===n&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===n&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===_e){let r=bn(t,this.parent);r.constructor===K?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=ll(e,e.doc.store,w(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;let s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ot(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ot(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(bn(e.doc.store,i.origin)))s.has(bn(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Tl(e.doc.store,this),this.content.integrate(e,this),al(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new K(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:w(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ot(e.origin,this.lastId)&&this.right===e&&ot(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Tn(e.deleteSet,this.id.client,this.id.clock,this.length),al(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw J();this.content.gc(e),t?sd(e,this,new K(this.id,this.length)):this.content=new Kt(this.length)}write(e,t){let r=t>0?w(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&31|(r===null?0:128)|(i===null?0:64)|(s===null?0:32);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){let l=this.parent;if(l._item!==void 0){let c=l._item;if(c===null){let a=mt(l);e.writeParentInfo(!0),e.writeString(a)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===_e?(e.writeParentInfo(!1),e.writeLeftID(l)):J();s!==null&&e.writeString(s)}this.content.write(e,t)}},nc=(n,e)=>Xd[e&31](n),Xd=[()=>{J()},Vd,Ld,Rd,zd,Pd,Fd,Gd,vd,Bd,()=>{J()}],Qd=10,q=class extends Ht{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){J()}write(e,t){e.writeInfo(Qd),m(e.restEncoder,this.length-t)}getMissing(e,t){return null}},rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},ic="__ $YJS$ __";rc[ic]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");rc[ic]=!0;var sc=new Map,fs=class{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:zo(t.newValue||"")}),Mo(this._onChange)}postMessage(e){hr.setItem(this.room,vo(Lo(e)))}close(){No(this._onChange)}},Zd=typeof BroadcastChannel>"u"?fs:BroadcastChannel,us=n=>F(sc,n,()=>{let e=te(),t=new Zd(n);return t.onmessage=r=>e.forEach(i=>i(r.data,"broadcastchannel")),{bc:t,subs:e}}),oc=(n,e)=>(us(n).subs.add(e),e),lc=(n,e)=>{let t=us(n),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),sc.delete(n)),r},yt=(n,e,t=null)=>{let r=us(n);r.bc.postMessage(e),r.subs.forEach(i=>i(e,t))};var cc=0,Fr=1,ac=2,Lr=(n,e)=>{m(n,cc);let t=rs(e);N(n,t)},ps=(n,e,t)=>{m(n,Fr),N(n,es(e,t))},tf=(n,e,t)=>ps(e,t,L(n)),hc=(n,e,t)=>{try{Zi(e,L(n),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},dc=(n,e)=>{m(n,ac),N(n,e)},nf=hc,fc=(n,e,t,r)=>{let i=y(n);switch(i){case cc:tf(n,e,t);break;case Fr:hc(n,t,r);break;case ac:nf(n,t,r);break;default:throw new Error("Unknown message type")}return i};var sf=0;var uc=(n,e,t)=>{switch(y(n)){case sf:t(e,he(n))}};var ms=3e4,vr=class extends ge{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=ie();this.getLocalState()!==null&&ms/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&ms<=t-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&zr(this,r,"timeout")},H(ms/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),i=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:i,lastUpdated:ie()});let o=[],l=[],c=[],a=[];e===null?a.push(t):s==null?e!=null&&o.push(t):(l.push(t),vt(s,e)||c.push(t)),(o.length>0||c.length>0||a.length>0)&&this.emit("change",[{added:o,updated:c,removed:a},"local"]),this.emit("update",[{added:o,updated:l,removed:a},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},zr=(n,e,t)=>{let r=[];for(let i=0;i<e.length;i++){let s=e[i];if(n.states.has(s)){if(n.states.delete(s),s===n.clientID){let o=n.meta.get(s);n.meta.set(s,{clock:o.clock+1,lastUpdated:ie()})}r.push(s)}}r.length>0&&(n.emit("change",[{added:[],updated:[],removed:r},t]),n.emit("update",[{added:[],updated:[],removed:r},t]))},Xt=(n,e,t=n.states)=>{let r=e.length,i=U();m(i,r);for(let s=0;s<r;s++){let o=e[s],l=t.get(o)||null,c=n.meta.get(o).clock;m(i,o),m(i,c),ye(i,JSON.stringify(l))}return E(i)};var pc=(n,e,t)=>{let r=R(e),i=ie(),s=[],o=[],l=[],c=[],a=y(r);for(let h=0;h<a;h++){let d=y(r),f=y(r),u=JSON.parse(he(r)),p=n.meta.get(d),g=n.states.get(d),x=p===void 0?0:p.clock;(x<f||x===f&&u===null&&n.states.has(d))&&(u===null?d===n.clientID&&n.getLocalState()!=null?f++:n.states.delete(d):n.states.set(d,u),n.meta.set(d,{clock:f,lastUpdated:i}),p===void 0&&u!==null?s.push(d):p!==void 0&&u===null?c.push(d):u!==null&&(vt(u,g)||l.push(d),o.push(d)))}(s.length>0||l.length>0||c.length>0)&&n.emit("change",[{added:s,updated:l,removed:c},t]),(s.length>0||o.length>0||c.length>0)&&n.emit("update",[{added:s,updated:o,removed:c},t])};var mc=n=>Uo(n,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");var wt=0,yc=3,Qt=1,af=2,Vn=[];Vn[wt]=(n,e,t,r,i)=>{m(n,wt);let s=fc(e,n,t.doc,t);r&&s===Fr&&!t.synced&&(t.synced=!0)};Vn[yc]=(n,e,t,r,i)=>{m(n,Qt),N(n,Xt(t.awareness,Array.from(t.awareness.getStates().keys())))};Vn[Qt]=(n,e,t,r,i)=>{pc(t.awareness,L(e),t)};Vn[af]=(n,e,t,r,i)=>{uc(e,t.doc,(s,o)=>hf(t,o))};var gc=3e4,hf=(n,e)=>console.warn(`Permission denied to access ${n.url}.
${e}`),wc=(n,e,t)=>{let r=R(e),i=U(),s=y(r),o=n.messageHandlers[s];return o?o(i,r,n,t,s):console.error("Unable to compute message"),i},xc=n=>{if(n.shouldConnect&&n.ws===null){let e=new n._WS(n.url);e.binaryType="arraybuffer",n.ws=e,n.wsconnecting=!0,n.wsconnected=!1,n.synced=!1,e.onmessage=t=>{n.wsLastMessageReceived=ie();let r=wc(n,new Uint8Array(t.data),!0);sr(r)>1&&e.send(E(r))},e.onerror=t=>{n.emit("connection-error",[t,n])},e.onclose=t=>{n.emit("connection-close",[t,n]),n.ws=null,n.wsconnecting=!1,n.wsconnected?(n.wsconnected=!1,n.synced=!1,zr(n.awareness,Array.from(n.awareness.getStates().keys()).filter(r=>r!==n.doc.clientID),n),n.emit("status",[{status:"disconnected"}])):n.wsUnsuccessfulReconnects++,setTimeout(xc,ne(ho(2,n.wsUnsuccessfulReconnects)*100,n.maxBackoffTime),n)},e.onopen=()=>{n.wsLastMessageReceived=ie(),n.wsconnecting=!1,n.wsconnected=!0,n.wsUnsuccessfulReconnects=0,n.emit("status",[{status:"connected"}]);let t=U();if(m(t,wt),Lr(t,n.doc),e.send(E(t)),n.awareness.getLocalState()!==null){let r=U();m(r,Qt),N(r,Xt(n.awareness,[n.doc.clientID])),e.send(E(r))}},n.emit("status",[{status:"connecting"}])}},gs=(n,e)=>{let t=n.ws;n.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),n.bcconnected&&yt(n.bcChannel,e,n)},ys=class extends ge{constructor(e,t,r,{connect:i=!0,awareness:s=new vr(r),params:o={},WebSocketPolyfill:l=WebSocket,resyncInterval:c=-1,maxBackoffTime:a=2500,disableBc:h=!1}={}){for(super();e[e.length-1]==="/";)e=e.slice(0,e.length-1);let d=mc(o);this.maxBackoffTime=a,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(d.length===0?"":"?"+d),this.roomname=t,this.doc=r,this._WS=l,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=h,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Vn.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=i,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let f=U();m(f,wt),Lr(f,r),this.ws.send(E(f))}},c)),this._bcSubscriber=(f,u)=>{if(u!==this){let p=wc(this,new Uint8Array(f),!1);sr(p)>1&&yt(this.bcChannel,E(p),this)}},this._updateHandler=(f,u)=>{if(u!==this){let p=U();m(p,wt),dc(p,f),gs(this,E(p))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:f,updated:u,removed:p},g)=>{let x=f.concat(u).concat(p),S=U();m(S,Qt),N(S,Xt(s,x)),gs(this,E(S))},this._exitHandler=()=>{zr(this.awareness,[r.clientID],"app closed")},ze&&typeof process<"u"&&process.on("exit",this._exitHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&gc<ie()-this.wsLastMessageReceived&&this.ws.close()},gc/10),i&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof process<"u"&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(oc(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let e=U();m(e,wt),Lr(e,this.doc),yt(this.bcChannel,E(e),this);let t=U();m(t,wt),ps(t,this.doc),yt(this.bcChannel,E(t),this);let r=U();m(r,yc),yt(this.bcChannel,E(r),this);let i=U();m(i,Qt),N(i,Xt(this.awareness,[this.doc.clientID])),yt(this.bcChannel,E(i),this)}disconnectBc(){let e=U();m(e,Qt),N(e,Xt(this.awareness,[this.doc.clientID],new Map)),gs(this,E(e)),this.bcconnected&&(lc(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(xc(this),this.connectBc())}};function Ec(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let i=n.child(r),s=e.child(r);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=Ec(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function Dc(n,e,t,r){for(let i=n.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:r};let o=n.child(--i),l=e.child(--s),c=o.nodeSize;if(o==l){t-=c,r-=c;continue}if(!o.sameMarkup(l))return{a:t,b:r};if(o.isText&&o.text!=l.text){let a=0,h=Math.min(o.text.length,l.text.length);for(;a<h&&o.text[o.text.length-a-1]==l.text[l.text.length-a-1];)a++,t--,r--;return{a:t,b:r}}if(o.content.size||l.content.size){let a=Dc(o.content,l.content,t-1,r-1);if(a)return a}t-=c,r-=c}}var k=class n{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,i=0,s){for(let o=0,l=0;l<t;o++){let c=this.content[o],a=l+c.nodeSize;if(a>e&&r(c,i+l,s||null,o)!==!1&&c.content.size){let h=l+1;c.nodesBetween(Math.max(0,e-h),Math.min(c.content.size,t-h),r,i+h)}l=a}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,i){let s="",o=!0;return this.nodesBetween(e,t,(l,c)=>{l.isText?(s+=l.text.slice(Math.max(e,c)-c,t-c),o=!r):l.isLeaf?(i?s+=typeof i=="function"?i(l):i:l.type.spec.leafText&&(s+=l.type.spec.leafText(l)),o=!r):!o&&l.isBlock&&(s+=r,o=!0)},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(r)&&(i[i.length-1]=t.withText(t.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new n(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let l=this.content[s],c=o+l.nodeSize;c>e&&((o<e||c>t)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,t-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,t-o-1))),r.push(l),i+=l.nodeSize),o=c}return new n(r,i)}cutByIndex(e,t){return e==t?n.empty:e==0&&t==this.content.length?this:new n(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-r.nodeSize;return i[e]=t,new n(i,s)}addToStart(e){return new n([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new n(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let i=this.content[t];e(i,r,t),r+=i.nodeSize}}findDiffStart(e,t=0){return Ec(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return Dc(this,e,t,r)}findIndex(e,t=-1){if(e==0)return Jr(0,e);if(e==this.size)return Jr(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let s=this.child(r),o=i+s.nodeSize;if(o>=e)return o==e||t>0?Jr(r+1,o):Jr(r,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return n.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new n(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return n.empty;let t,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new n(t||e,r)}static from(e){if(!e)return n.empty;if(e instanceof n)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new n([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};k.empty=new k([],0);var ws={index:0,offset:0};function Jr(n,e){return ws.index=n,ws.offset=e,ws}function qr(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!qr(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!qr(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}var V=class n{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),r=!0),t&&t.push(s)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&qr(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);return r.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return n.none;if(e instanceof n)return[e];let t=e.slice();return t.sort((r,i)=>r.type.rank-i.type.rank),t}};V.none=[];var bt=class extends Error{},b=class n{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=Mc(this.content,e+this.openStart,t);return r&&new n(r,this.openStart,this.openEnd)}removeBetween(e,t){return new n(Oc(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return n.empty;let r=t.openStart||0,i=t.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new n(k.fromJSON(e,t.content),r,i)}static maxOpen(e,t=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new n(e,r,i)}};b.empty=new b(k.empty,0,0);function Oc(n,e,t){let{index:r,offset:i}=n.findIndex(e),s=n.maybeChild(r),{index:o,offset:l}=n.findIndex(t);if(i==e||s.isText){if(l!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,s.copy(Oc(s.content,e-i-1,t-i-1)))}function Mc(n,e,t,r){let{index:i,offset:s}=n.findIndex(e),o=n.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,t)?null:n.cut(0,e).append(t).append(n.cut(e));let l=Mc(o.content,e-s-1,t);return l&&n.replaceChild(i,o.copy(l))}function df(n,e,t){if(t.openStart>n.depth)throw new bt("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new bt("Inconsistent open depths");return Nc(n,e,t,0)}function Nc(n,e,t,r){let i=n.index(r),s=n.node(r);if(i==e.index(r)&&r<n.depth-t.openStart){let o=Nc(n,e,t,r+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let o=n.parent,l=o.content;return St(o,l.cut(0,n.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=ff(t,n);return St(s,Ic(n,o,l,e,r))}else return St(s,Yr(n,e,r))}function Ac(n,e){if(!e.type.compatibleContent(n.type))throw new bt("Cannot join "+e.type.name+" onto "+n.type.name)}function ks(n,e,t){let r=n.node(t);return Ac(r,e.node(t)),r}function xt(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function Bn(n,e,t,r){let i=(e||n).node(t),s=0,o=e?e.index(t):i.childCount;n&&(s=n.index(t),n.depth>t?s++:n.textOffset&&(xt(n.nodeAfter,r),s++));for(let l=s;l<o;l++)xt(i.child(l),r);e&&e.depth==t&&e.textOffset&&xt(e.nodeBefore,r)}function St(n,e){return n.type.checkContent(e),n.copy(e)}function Ic(n,e,t,r,i){let s=n.depth>i&&ks(n,e,i+1),o=r.depth>i&&ks(t,r,i+1),l=[];return Bn(null,n,i,l),s&&o&&e.index(i)==t.index(i)?(Ac(s,o),xt(St(s,Ic(n,e,t,r,i+1)),l)):(s&&xt(St(s,Yr(n,e,i+1)),l),Bn(e,t,i,l),o&&xt(St(o,Yr(t,r,i+1)),l)),Bn(r,null,i,l),new k(l)}function Yr(n,e,t){let r=[];if(Bn(null,n,t,r),n.depth>t){let i=ks(n,e,t+1);xt(St(i,Yr(n,e,t+1)),r)}return Bn(e,null,t,r),new k(r)}function ff(n,e){let t=e.depth-n.openStart,i=e.node(t).copy(n.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(k.from(i));return{start:i.resolveNoCache(n.openStart+t),end:i.resolveNoCache(i.content.size-n.openEnd-t)}}var Wr=class n{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(t);return r?e.child(t).cut(r):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return V.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),i=e.maybeChild(t);if(!r){let l=r;r=i,i=l}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new Cs(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],i=0,s=t;for(let o=e;;){let{index:l,offset:c}=o.content.findIndex(s),a=s-c;if(r.push(o,l,i+c),!a||(o=o.child(l),o.isText))break;s=a-1,i+=c+1}return new n(t,r,s)}static resolveCached(e,t){for(let i=0;i<xs.length;i++){let s=xs[i];if(s.pos==t&&s.doc==e)return s}let r=xs[Ss]=n.resolve(e,t);return Ss=(Ss+1)%uf,r}},xs=[],Ss=0,uf=12,Cs=class{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},pf=Object.create(null),Hr=class n{constructor(e,t,r,i=V.none){this.type=e,this.attrs=t,this.marks=i,this.content=r||k.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,i=0){this.content.nodesBetween(e,t,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,i){return this.content.textBetween(e,t,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&qr(this.attrs,t||e.defaultAttrs||pf)&&V.sameSet(this.marks,r||V.none)}copy(e=null){return e==this.content?this:new n(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new n(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return b.empty;let i=this.resolve(e),s=this.resolve(t),o=r?0:i.sharedDepth(t),l=i.start(o),a=i.node(o).content.cut(i.pos-l,s.pos-l);return new b(a,i.depth-o,s.depth-o)}replace(e,t,r){return df(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let i=this.content.child(t-1);return{node:i,index:t-1,offset:r-i.nodeSize}}resolve(e){return Wr.resolveCached(this,e)}resolveNoCache(e){return Wr.resolve(this,e)}rangeHasMark(e,t,r){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),mf(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=k.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),l=o&&o.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let c=i;c<s;c++)if(!this.type.allowsMarks(r.child(c).marks))return!1;return!0}canReplaceWith(e,t,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=V.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!V.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let i=k.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,r)}};Hr.prototype.text=void 0;function mf(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}var Fn=class n{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new Ts(e,t);if(r.next==null)return n.empty;let i=_c(r);r.next&&r.err("Unexpected trailing text");let s=kf(bf(i));return Cf(s,r),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let i=this;for(let s=t;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let i=[this];function s(o,l){let c=o.matchFragment(e,r);if(c&&(!t||c.validEnd))return k.from(l.map(a=>a.createAndFill()));for(let a=0;a<o.next.length;a++){let{type:h,next:d}=o.next[a];if(!(h.isText||h.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,l.concat(h));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let l=i;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:l,next:c}=s.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!i.type||c.validEnd)&&(r.push({match:l.contentMatch,type:l,via:i}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&t(r.next[i].next)}return t(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}};Fn.empty=new Fn(!0);var Ts=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function _c(n){let e=[];do e.push(gf(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function gf(n){let e=[];do e.push(yf(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function yf(n){let e=Sf(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=wf(n,e);else break;return e}function Sc(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function wf(n,e){let t=Sc(n),r=t;return n.eat(",")&&(n.next!="}"?r=Sc(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function xf(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let i=[];for(let s in t){let o=t[s];o.groups.indexOf(e)>-1&&i.push(o)}return i.length==0&&n.err("No node type or group '"+e+"' found"),i}function Sf(n){if(n.eat("(")){let e=_c(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=xf(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function bf(n){let e=[[]];return i(s(n,0),t()),e;function t(){return e.push([])-1}function r(o,l,c){let a={term:c,to:l};return e[o].push(a),a}function i(o,l){o.forEach(c=>c.to=l)}function s(o,l){if(o.type=="choice")return o.exprs.reduce((c,a)=>c.concat(s(a,l)),[]);if(o.type=="seq")for(let c=0;;c++){let a=s(o.exprs[c],l);if(c==o.exprs.length-1)return a;i(a,l=t())}else if(o.type=="star"){let c=t();return r(l,c),i(s(o.expr,c),c),[r(c)]}else if(o.type=="plus"){let c=t();return i(s(o.expr,l),c),i(s(o.expr,c),c),[r(c)]}else{if(o.type=="opt")return[r(l)].concat(s(o.expr,l));if(o.type=="range"){let c=l;for(let a=0;a<o.min;a++){let h=t();i(s(o.expr,c),h),c=h}if(o.max==-1)i(s(o.expr,c),c);else for(let a=o.min;a<o.max;a++){let h=t();r(c,h),i(s(o.expr,c),h),c=h}return[r(c)]}else{if(o.type=="name")return[r(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Uc(n,e){return e-n}function bc(n,e){let t=[];return r(e),t.sort(Uc);function r(i){let s=n[i];if(s.length==1&&!s[0].term)return r(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:l,to:c}=s[o];!l&&t.indexOf(c)==-1&&r(c)}}}function kf(n){let e=Object.create(null);return t(bc(n,0));function t(r){let i=[];r.forEach(o=>{n[o].forEach(({term:l,to:c})=>{if(!l)return;let a;for(let h=0;h<i.length;h++)i[h][0]==l&&(a=i[h][1]);bc(n,c).forEach(h=>{a||i.push([l,a=[]]),a.indexOf(h)==-1&&a.push(h)})})});let s=e[r.join(",")]=new Fn(r.indexOf(n.length-1)>-1);for(let o=0;o<i.length;o++){let l=i[o][1].sort(Uc);s.next.push({type:i[o][0],next:e[l.join(",")]||t(l)})}return s}}function Cf(n,e){for(let t=0,r=[n];t<r.length;t++){let i=r[t],s=!i.validEnd,o=[];for(let l=0;l<i.next.length;l++){let{type:c,next:a}=i.next[l];o.push(c.name),s&&!(c.isText||c.hasRequiredAttrs())&&(s=!1),r.indexOf(a)==-1&&r.push(a)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}var Kr=class n{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(r=>{r.tag?this.tags.push(r):r.style&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new Gr(this,t,!1);return r.addAll(e,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new Gr(this,t,!0);return r.addAll(e,t.from,t.to),b.maxOpen(r.finish())}matchTag(e,t,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Df(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(o.getAttrs){let c=o.getAttrs(t);if(c===!1)continue;o.attrs=c||void 0}return o}}}static schemaRules(e){let t=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let l=t[o];if((l.priority==null?50:l.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=Cc(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=Cc(o)),o.node||o.ignore||o.mark||(o.node=i)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new n(e,n.schemaRules(e)))}},Rc={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Tf={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Vc={ol:!0,ul:!0},jr=1,$r=2,Pn=4;function kc(n,e,t){return e!=null?(e?jr:0)|(e==="full"?$r:0):n&&n.whitespace=="pre"?jr|$r:t&~Pn}var Zt=class{constructor(e,t,r,i,s,o,l){this.type=e,this.attrs=t,this.marks=r,this.pendingMarks=i,this.solid=s,this.options=l,this.content=[],this.activeMarks=V.none,this.stashMarks=[],this.match=o||(l&Pn?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(k.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&jr)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=k.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(k.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,r=this.pendingMarks;t<r.length;t++){let i=r[t];(this.type?this.type.allowsMarkType(i.type):Mf(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Rc.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},Gr=class{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0;let i=t.topNode,s,o=kc(null,t.preserveWhitespace,0)|(r?Pn:0);i?s=new Zt(i.type,i.attrs,V.none,V.none,!0,t.topMatch||i.type.contentMatch,o):r?s=new Zt(null,null,V.none,V.none,!0,null,o):s=new Zt(e.schema.topNodeType,null,V.none,V.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){let t=e.getAttribute("style");if(!t)this.addElement(e);else{let r=this.readStyles(Of(t));if(!r)return;let[i,s]=r,o=this.top;for(let l=0;l<s.length;l++)this.removePendingMark(s[l],o);for(let l=0;l<i.length;l++)this.addPendingMark(i[l]);this.addElement(e);for(let l=0;l<i.length;l++)this.removePendingMark(i[l],o);for(let l=0;l<s.length;l++)this.addPendingMark(s[l])}}}addTextNode(e){let t=e.nodeValue,r=this.top;if(r.options&$r||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(r.options&jr)r.options&$r?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1],s=e.previousSibling;(!i||s&&s.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let r=e.nodeName.toLowerCase(),i;Vc.hasOwnProperty(r)&&this.parser.normalizeLists&&Ef(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(s?s.ignore:Tf.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let o,l=this.top,c=this.needsBlock;if(Rc.hasOwnProperty(r))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),o=!0,l.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),o&&this.sync(l),this.needsBlock=c}else this.addElementByRule(e,s,s.consuming===!1?i:void 0)}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=V.none,r=V.none;e:for(let i=0;i<e.length;i+=2)for(let s=void 0;;){let o=this.parser.matchStyle(e[i],e[i+1],this,s);if(!o)continue e;if(o.ignore)return null;if(o.clearMark?this.top.pendingMarks.forEach(l=>{o.clearMark(l)&&(r=l.addToSet(r))}):t=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(t),o.consuming===!1)s=o;else break}return[t,r]}addElementByRule(e,t,r){let i,s,o;t.node?(s=this.parser.schema.nodes[t.node],s.isLeaf?this.insertNode(s.create(t.attrs))||this.leafFallback(e):i=this.enter(s,t.attrs||null,t.preserveWhitespace)):(o=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(o));let l=this.top;if(s&&s.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(c=>this.insertNode(c));else{let c=e;typeof t.contentElement=="string"?c=e.querySelector(t.contentElement):typeof t.contentElement=="function"?c=t.contentElement(e):t.contentElement&&(c=t.contentElement),this.findAround(e,c,!0),this.addAll(c)}i&&this.sync(l)&&this.open--,o&&this.removePendingMark(o,l)}addAll(e,t,r){let i=t||0;for(let s=t?e.childNodes[t]:e.firstChild,o=r==null?null:e.childNodes[r];s!=o;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s);this.findAtPoint(e,i)}findPlace(e){let t,r;for(let i=this.open;i>=0;i--){let s=this.nodes[i],o=s.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,r=s,!o.length)||s.solid)break}if(!t)return!1;this.sync(r);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let r=t.activeMarks;for(let i=0;i<e.marks.length;i++)(!t.type||t.type.allowsMarkType(e.marks[i].type))&&(r=e.marks[i].addToSet(r));return t.content.push(e.mark(r)),!0}return!1}enter(e,t,r){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,r),i}enterInner(e,t=null,r=!1,i){this.closeExtra();let s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);let o=kc(e,i,s.options);s.options&Pn&&s.content.length==0&&(o|=Pn),this.nodes.push(new Zt(e,t,s.activeMarks,s.pendingMarks,r,null,o)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(l,c)=>{for(;l>=0;l--){let a=t[l];if(a==""){if(l==t.length-1||l==0)continue;for(;c>=s;c--)if(o(l-1,c))return!0;return!1}else{let h=c>0||c==0&&i?this.nodes[c].type:r&&c>=s?r.node(c-s).type:null;if(!h||h.name!=a&&h.groups.indexOf(a)==-1)return!1;c--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(e){let t=Nf(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let r=this.open;r>=0;r--){let i=this.nodes[r];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==t)break}}};function Ef(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Vc.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function Df(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function Of(n){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,r=[];for(;t=e.exec(n);)r.push(t[1],t[2].trim());return r}function Cc(n){let e={};for(let t in n)e[t]=n[t];return e}function Mf(n,e){let t=e.schema.nodes;for(let r in t){let i=t[r];if(!i.allowsMarkType(n))continue;let s=[],o=l=>{s.push(l);for(let c=0;c<l.edgeCount;c++){let{type:a,next:h}=l.edge(c);if(a==e||s.indexOf(h)<0&&o(h))return!0}};if(o(i.contentMatch))return!0}}function Nf(n,e){for(let t=0;t<e.length;t++)if(n.eq(e[t]))return e[t]}var Ln=class n{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=bs(t).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let l=0,c=0;for(;l<s.length&&c<o.marks.length;){let a=o.marks[c];if(!this.marks[a.type.name]){c++;continue}if(!a.eq(s[l][0])||a.type.spec.spanning===!1)break;l++,c++}for(;l<s.length;)i=s.pop()[1];for(;c<o.marks.length;){let a=o.marks[c++],h=this.serializeMark(a,o.isInline,t);h&&(s.push([a,i]),i.appendChild(h.dom),i=h.contentDOM||h.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:i}=n.renderSpec(bs(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,t,r={}){let i=this.marks[e.type.name];return i&&n.renderSpec(bs(r),i(e,t))}static renderSpec(e,t,r=null){if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,l=r?e.createElementNS(r,i):e.createElement(i),c=t[1],a=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){a=2;for(let h in c)if(c[h]!=null){let d=h.indexOf(" ");d>0?l.setAttributeNS(h.slice(0,d),h.slice(d+1),c[h]):l.setAttribute(h,c[h])}}for(let h=a;h<t.length;h++){let d=t[h];if(d===0){if(h<t.length-1||h>a)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:u}=n.renderSpec(e,d,r);if(l.appendChild(f),u){if(o)throw new RangeError("Multiple content holes");o=u}}}return{dom:l,contentDOM:o}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new n(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Tc(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return Tc(e.marks)}};function Tc(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function bs(n){return n.document||window.document}var Pc=65535,Fc=Math.pow(2,16);function If(n,e){return n+e*Fc}function Bc(n){return n&Pc}function _f(n){return(n-(n&Pc))/Fc}var Lc=1,vc=2,Xr=4,zc=8,Qr=class{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&zc)>0}get deletedBefore(){return(this.delInfo&(Lc|Xr))>0}get deletedAfter(){return(this.delInfo&(vc|Xr))>0}get deletedAcross(){return(this.delInfo&Xr)>0}},Pe=class n{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&n.empty)return n.empty}recover(e){let t=0,r=Bc(e);if(!this.inverted)for(let i=0;i<r;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+t+_f(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?i:0);if(c>e)break;let a=this.ranges[l+s],h=this.ranges[l+o],d=c+a;if(e<=d){let f=a?e==c?-1:e==d?1:t:t,u=c+i+(f<0?0:h);if(r)return u;let p=e==(t<0?c:d)?null:If(l/3,e-c),g=e==c?vc:e==d?Lc:Xr;return(t<0?e!=c:e!=d)&&(g|=zc),new Qr(u,g,p)}i+=h-a}return r?e+i:new Qr(e+i,0,null)}touches(e,t){let r=0,i=Bc(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let c=this.ranges[l]-(this.inverted?r:0);if(c>e)break;let a=this.ranges[l+s],h=c+a;if(e<=h&&l==i*3)return!0;r+=this.ranges[l+o]-a}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],l=o-(this.inverted?s:0),c=o+(this.inverted?0:s),a=this.ranges[i+t],h=this.ranges[i+r];e(l,l+a,c,c+h),s+=h-a}}invert(){return new n(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?n.empty:new n(e<0?[0,-e,0]:[0,0,e])}};Pe.empty=new Pe([]);var Es=Object.create(null),z=class{getMap(){return Pe.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Es[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Es)throw new RangeError("Duplicate use of step JSON ID "+e);return Es[e]=t,t.prototype.jsonID=e,t}},W=class n{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new n(e,null)}static fail(e){return new n(null,e)}static fromReplace(e,t,r,i){try{return n.ok(e.replace(t,r,i))}catch(s){if(s instanceof bt)return n.fail(s.message);throw s}}};function Ns(n,e,t){let r=[];for(let i=0;i<n.childCount;i++){let s=n.child(i);s.content.size&&(s=s.copy(Ns(s.content,e,s))),s.isInline&&(s=e(s,t,i)),r.push(s)}return k.fromArray(r)}var Zr=class n extends z{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new b(Ns(t.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return W.fromReplace(e,this.from,this.to,s)}invert(){return new ei(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new n(t.pos,r.pos,this.mark)}merge(e){return e instanceof n&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new n(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new n(t.from,t.to,e.markFromJSON(t.mark))}};z.jsonID("addMark",Zr);var ei=class n extends z{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new b(Ns(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return W.fromReplace(e,this.from,this.to,r)}invert(){return new Zr(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new n(t.pos,r.pos,this.mark)}merge(e){return e instanceof n&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new n(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new n(t.from,t.to,e.markFromJSON(t.mark))}};z.jsonID("removeMark",ei);var ti=class n extends z{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return W.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return W.fromReplace(e,this.pos,this.pos+1,new b(k.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(r))return new n(this.pos,t.marks[i]);return new n(this.pos,this.mark)}}return new ni(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new n(t.pos,e.markFromJSON(t.mark))}};z.jsonID("addNodeMark",ti);var ni=class n extends z{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return W.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return W.fromReplace(e,this.pos,this.pos+1,new b(k.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new ti(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new n(t.pos,e.markFromJSON(t.mark))}};z.jsonID("removeNodeMark",ni);var vn=class n extends z{constructor(e,t,r,i=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=i}apply(e){return this.structure&&Ds(e,this.from,this.to)?W.fail("Structure replace would overwrite content"):W.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Pe([this.from,this.to-this.from,this.slice.size])}invert(e){return new n(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new n(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof n)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?b.empty:new b(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new n(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?b.empty:new b(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new n(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new n(t.from,t.to,b.fromJSON(e,t.slice),!!t.structure)}};z.jsonID("replace",vn);var zn=class n extends z{constructor(e,t,r,i,s,o,l=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=l}apply(e){if(this.structure&&(Ds(e,this.from,this.gapFrom)||Ds(e,this.gapTo,this.to)))return W.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return W.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?W.fromReplace(e,this.from,this.to,r):W.fail("Content does not fit in gap")}getMap(){return new Pe([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new n(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),s=e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||i<t.pos||s>r.pos?null:new n(t.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new n(t.from,t.to,t.gapFrom,t.gapTo,b.fromJSON(e,t.slice),t.insert,!!t.structure)}};z.jsonID("replaceAround",zn);function Ds(n,e,t){let r=n.resolve(e),i=t-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function Jc(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let i=t.content;for(let s=0;s<t.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=r.depth;o>=0;o--){let l=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,c=r.index(o)+(l>0?1:0),a=r.node(o),h=!1;if(s==1)h=a.canReplace(c,c,i);else{let d=a.contentMatchAt(c).findWrapping(i.firstChild.type);h=d&&a.canReplaceWith(c,c,d[0])}if(h)return l==0?r.pos:l<0?r.before(o+1):r.after(o+1)}return null}var Os=class n extends z{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return W.fail("No node at attribute step's position");let r=Object.create(null);for(let s in t.attrs)r[s]=t.attrs[s];r[this.attr]=this.value;let i=t.type.create(r,null,t.marks);return W.fromReplace(e,this.pos,this.pos+1,new b(k.from(i),0,t.isLeaf?0:1))}getMap(){return Pe.empty}invert(e){return new n(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new n(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new n(t.pos,t.attr,t.value)}};z.jsonID("attr",Os);var Ms=class n extends z{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let i in e.attrs)t[i]=e.attrs[i];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return W.ok(r)}getMap(){return Pe.empty}invert(e){return new n(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new n(t.attr,t.value)}};z.jsonID("docAttr",Ms);var Jn=class extends Error{};Jn=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};Jn.prototype=Object.create(Error.prototype);Jn.prototype.constructor=Jn;Jn.prototype.name="TransformError";var As=Object.create(null),M=class{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new _s(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=b.empty){let r=t.content.lastChild,i=null;for(let l=0;l<t.openEnd;l++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:c,$to:a}=o[l],h=e.mapping.slice(s);e.replaceRange(h.map(c.pos),h.map(a.pos),l?b.empty:t),l==0&&Wc(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:l}=i[s],c=e.mapping.slice(r),a=c.map(o.pos),h=c.map(l.pos);s?e.deleteRange(a,h):(e.replaceRangeWith(a,h,t),Wc(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let i=e.parent.inlineContent?new P(e):en(e.node(0),e.parent,e.pos,e.index(),t,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?en(e.node(0),e.node(s),e.before(s+1),e.index(s),t,r):en(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Fe(e.node(0))}static atStart(e){return en(e,e,0,0,1)||new Fe(e)}static atEnd(e){return en(e,e,e.content.size,e.childCount,-1)||new Fe(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=As[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in As)throw new RangeError("Duplicate use of selection JSON ID "+e);return As[e]=t,t.prototype.jsonID=e,t}getBookmark(){return P.between(this.$anchor,this.$head).getBookmark()}};M.prototype.visible=!0;var _s=class{constructor(e,t){this.$from=e,this.$to=t}},qc=!1;function Yc(n){!qc&&!n.parent.inlineContent&&(qc=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}var P=class n extends M{constructor(e,t=e){Yc(e),Yc(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return M.near(r);let i=e.resolve(t.map(this.anchor));return new n(i.parent.inlineContent?i:r,r)}replace(e,t=b.empty){if(super.replace(e,t),t==b.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof n&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new ri(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new n(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let i=e.resolve(t);return new this(i,r==t?i:e.resolve(r))}static between(e,t,r){let i=e.pos-t.pos;if((!r||i)&&(r=i>=0?1:-1),!t.parent.inlineContent){let s=M.findFrom(t,r,!0)||M.findFrom(t,-r,!0);if(s)t=s.$head;else return M.near(t,r)}return e.parent.inlineContent||(i==0?e=t:(e=(M.findFrom(e,-r,!0)||M.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new n(e,t)}};M.jsonID("text",P);var ri=class n{constructor(e,t){this.anchor=e,this.head=t}map(e){return new n(e.map(this.anchor),e.map(this.head))}resolve(e){return P.between(e.resolve(this.anchor),e.resolve(this.head))}},T=class n extends M{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return r?M.near(s):new n(s)}content(){return new b(k.from(this.node),0,0)}eq(e){return e instanceof n&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Us(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new n(e.resolve(t.anchor))}static create(e,t){return new n(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};T.prototype.visible=!1;M.jsonID("node",T);var Us=class n{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new ri(r,r):new n(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&T.isSelectable(r)?new T(t):M.near(t)}},Fe=class n extends M{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=b.empty){if(t==b.empty){e.delete(0,e.doc.content.size);let r=M.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new n(e)}map(e){return new n(e)}eq(e){return e instanceof n}getBookmark(){return Uf}};M.jsonID("all",Fe);var Uf={map(){return this},resolve(n){return new Fe(n)}};function en(n,e,t,r,i,s=!1){if(e.inlineContent)return P.create(n,t);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let l=e.child(o);if(l.isAtom){if(!s&&T.isSelectable(l))return T.create(n,t-(i<0?l.nodeSize:0))}else{let c=en(n,l,t+i,i<0?l.childCount:0,i,s);if(c)return c}t+=l.nodeSize*i}return null}function Wc(n,e,t){let r=n.steps.length-1;if(r<e)return;let i=n.steps[r];if(!(i instanceof vn||i instanceof zn))return;let s=n.mapping.maps[r],o;s.forEach((l,c,a,h)=>{o==null&&(o=h)}),n.setSelection(M.near(n.doc.resolve(o),t))}function Hc(n,e){return!e||!n?n:n.bind(e)}var tn=class{constructor(e,t,r){this.name=e,this.init=Hc(t.init,r),this.apply=Hc(t.apply,r)}},_p=[new tn("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new tn("selection",{init(n,e){return n.selection||M.atStart(e.doc)},apply(n){return n.selection}}),new tn("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new tn("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];function Kc(n,e,t){for(let r in n){let i=n[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=Kc(i,e,{})),t[r]=i}return t}var Ge=class{constructor(e){this.spec=e,this.props={},e.props&&Kc(e.props,this,this.props),this.key=e.key?e.key.key:jc("plugin")}getState(e){return e[this.key]}},Is=Object.create(null);function jc(n){return n in Is?n+"$"+ ++Is[n]:(Is[n]=0,n+"$")}var nn=class{constructor(e="key"){this.key=jc(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var Hn=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e};var aa=function(n,e,t,r){return t&&($c(n,e,t,r,-1)||$c(n,e,t,r,1))},Rf=/^(img|br|input|textarea|hr)$/i;function $c(n,e,t,r,i){for(;;){if(n==t&&e==r)return!0;if(e==(i<0?0:ii(n))){let s=n.parentNode;if(!s||s.nodeType!=1||Bf(n)||Rf.test(n.nodeName)||n.contentEditable=="false")return!1;e=Hn(n)+(i<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(i<0?-1:0)],n.contentEditable=="false")return!1;e=i<0?ii(n):0}else return!1}}function ii(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Vf(n,e,t){for(let r=e==0,i=e==ii(n);r||i;){if(n==t)return!0;let s=Hn(n);if(n=n.parentNode,!n)return!1;r=r&&s==0,i=i&&s==ii(n)}}function Bf(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}var ha=function(n){return n.focusNode&&aa(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function da(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}var Me=typeof navigator<"u"?navigator:null,Gc=typeof document<"u"?document:null,Qe=Me&&Me.userAgent||"",Vs=/Edge\/(\d+)/.exec(Qe),fa=/MSIE \d/.exec(Qe),Bs=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qe),ln=!!(fa||Bs||Vs),Ks=fa?document.documentMode:Bs?+Bs[1]:Vs?+Vs[1]:0,ci=!ln&&/gecko\/(\d+)/i.test(Qe);ci&&+(/Firefox\/(\d+)/.exec(Qe)||[0,0])[1];var Ps=!ln&&/Chrome\/(\d+)/.exec(Qe),Dt=!!Ps,Pf=Ps?+Ps[1]:0,Ot=!ln&&!!Me&&/Apple Computer/.test(Me.vendor),js=Ot&&(/Mobile\/\w+/.test(Qe)||!!Me&&Me.maxTouchPoints>2),fe=js||(Me?/Mac/.test(Me.platform):!1),Ff=Me?/Win/.test(Me.platform):!1,Kn=/Android \d/.test(Qe),$s=!!Gc&&"webkitFontSmoothing"in Gc.documentElement.style,Lf=$s?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;var ua=function(n){n&&(this.nodeName=n)};ua.prototype=Object.create(null);var Pp=[new ua];function vf(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let i=n.docView.nearestDesc(t.focusNode),s=i&&i.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let l=r.resolve(o),c,a;if(ha(t)){for(c=l;i&&!i.node;)i=i.parent;let h=i.node;if(i&&h.isAtom&&T.isSelectable(h)&&i.parent&&!(h.isInline&&Vf(t.focusNode,t.focusOffset,i.dom))){let d=i.posBefore;a=new T(o==d?l:r.resolve(d))}}else{let h=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(h<0)return null;c=r.resolve(h)}if(!a){let h=e=="pointer"||n.state.selection.head<l.pos&&!s?1:-1;a=ma(n,c,l,h)}return a}function pa(n){return n.editable?n.hasFocus():Yf(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Gs(n,e=!1){let t=n.state.selection;if(qf(n,t),!!pa(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Dt){let r=n.domSelectionRange(),i=n.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&aa(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)Jf(n);else{let{anchor:r,head:i}=t,s,o;Xc&&!(t instanceof P)&&(t.$from.parent.inlineContent||(s=Qc(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Qc(n,t.to))),n.docView.setSelection(r,i,n.root,e),Xc&&(s&&Zc(s),o&&Zc(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&zf(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}var Xc=Ot||Dt&&Pf<63;function Qc(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),i=r<t.childNodes.length?t.childNodes[r]:null,s=r?t.childNodes[r-1]:null;if(Ot&&i&&i.contentEditable=="false")return Rs(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Rs(i);if(s)return Rs(s)}}function Rs(n){return n.contentEditable="true",Ot&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Zc(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function zf(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!pa(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function Jf(n){let e=n.domSelection(),t=document.createRange(),r=n.cursorWrapper.dom,i=r.nodeName=="IMG";i?t.setEnd(r.parentNode,Hn(r)+1):t.setEnd(r,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!n.state.selection.visible&&ln&&Ks<=11&&(r.disabled=!0,r.disabled=!1)}function qf(n,e){if(e instanceof T){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(ea(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else ea(n)}function ea(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function ma(n,e,t,r){return n.someProp("createSelectionBetween",i=>i(n,e,t))||P.between(e,t,r)}function Yf(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Fs(n,e){let{$anchor:t,$head:r}=n.selection,i=e>0?t.max(r):t.min(r),s=i.parent.inlineContent?i.depth?n.doc.resolve(e>0?i.after():i.before()):null:i;return s&&M.findFrom(s,e)}function kt(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function ta(n,e,t){let r=n.state.selection;if(r instanceof P){if(!r.empty||t.indexOf("s")>-1)return!1;if(n.endOfTextblock(e>0?"forward":"backward")){let i=Fs(n.state,e);return i&&i instanceof T?kt(n,i):!1}else if(!(fe&&t.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let l=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=n.docView.descAt(l))&&!o.contentDOM?T.isSelectable(s)?kt(n,new T(e<0?n.state.doc.resolve(i.pos-s.nodeSize):i)):$s?kt(n,new P(n.state.doc.resolve(e<0?l:l+s.nodeSize))):!1:!1}}else{if(r instanceof T&&r.node.isInline)return kt(n,new P(e>0?r.$to:r.$from));{let i=Fs(n.state,e);return i?kt(n,i):!1}}}function si(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Yn(n){let e=n.pmViewDesc;return e&&e.size==0&&(n.nextSibling||n.nodeName!="BR")}function qn(n,e){return e<0?Wf(n):ga(n)}function Wf(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i,s,o=!1;for(ci&&t.nodeType==1&&r<si(t)&&Yn(t.childNodes[r])&&(o=!0);;)if(r>0){if(t.nodeType!=1)break;{let l=t.childNodes[r-1];if(Yn(l))i=t,s=--r;else if(l.nodeType==3)t=l,r=t.nodeValue.length;else break}}else{if(ya(t))break;{let l=t.previousSibling;for(;l&&Yn(l);)i=t.parentNode,s=Hn(l),l=l.previousSibling;if(l)t=l,r=si(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}o?Ls(n,t,r):i&&Ls(n,i,s)}function ga(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let i=si(t),s,o;for(;;)if(r<i){if(t.nodeType!=1)break;let l=t.childNodes[r];if(Yn(l))s=t,o=++r;else break}else{if(ya(t))break;{let l=t.nextSibling;for(;l&&Yn(l);)s=l.parentNode,o=Hn(l)+1,l=l.nextSibling;if(l)t=l,r=0,i=si(t);else{if(t=t.parentNode,t==n.dom)break;r=i=0}}}s&&Ls(n,s,o)}function ya(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ls(n,e,t){let r=n.domSelection();if(ha(r)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:i}=n;setTimeout(()=>{n.state==i&&Gs(n)},50)}function na(n,e){let t=n.state.doc.resolve(e);if(!(Dt||Ff)&&t.parent.inlineContent){let i=n.coordsAtPos(e);if(e>t.start()){let s=n.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<t.end()){let s=n.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function ra(n,e,t){let r=n.state.selection;if(r instanceof P&&!r.empty||t.indexOf("s")>-1||fe&&t.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=Fs(n.state,e);if(o&&o instanceof T)return kt(n,o)}if(!i.parent.inlineContent){let o=e<0?i:s,l=r instanceof Fe?M.near(o,e):M.findFrom(o,e);return l?kt(n,l):!1}return!1}function ia(n,e){if(!(n.state.selection instanceof P))return!0;let{$head:t,$anchor:r,empty:i}=n.state.selection;if(!t.sameParent(r))return!0;if(!i)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=n.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),n.dispatch(o),!0}return!1}function sa(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function Hf(n){if(!Ot||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;sa(n,r,"true"),setTimeout(()=>sa(n,r,"false"),20)}return!1}function Kf(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function jf(n,e){let t=e.keyCode,r=Kf(e);if(t==8||fe&&t==72&&r=="c")return ia(n,-1)||qn(n,-1);if(t==46||fe&&t==68&&r=="c")return ia(n,1)||qn(n,1);if(t==13||t==27)return!0;if(t==37||fe&&t==66&&r=="c"){let i=t==37?na(n,n.state.selection.from)=="ltr"?-1:1:-1;return ta(n,i,r)||qn(n,i)}else if(t==39||fe&&t==70&&r=="c"){let i=t==39?na(n,n.state.selection.from)=="ltr"?1:-1:1;return ta(n,i,r)||qn(n,i)}else{if(t==38||fe&&t==80&&r=="c")return ra(n,-1,r)||qn(n,-1);if(t==40||fe&&t==78&&r=="c")return Hf(n)||ra(n,1,r)||ga(n);if(r==(fe?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function wa(n,e){n.someProp("transformCopied",u=>{e=u(e,n)});let t=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let u=r.firstChild;t.push(u.type.name,u.attrs!=u.type.defaultAttrs?u.attrs:null),r=u.content}let o=n.someProp("clipboardSerializer")||Ln.fromSchema(n.state.schema),l=Ta(),c=l.createElement("div");c.appendChild(o.serializeFragment(r,{document:l}));let a=c.firstChild,h,d=0;for(;a&&a.nodeType==1&&(h=Ca[a.nodeName.toLowerCase()]);){for(let u=h.length-1;u>=0;u--){let p=l.createElement(h[u]);for(;c.firstChild;)p.appendChild(c.firstChild);c.appendChild(p),d++}a=c.firstChild}a&&a.nodeType==1&&a.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let f=n.someProp("clipboardTextSerializer",u=>u(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:c,text:f}}function xa(n,e,t,r,i){let s=i.parent.type.spec.code,o,l;if(!t&&!e)return null;let c=e&&(r||s||!t);if(c){if(n.someProp("transformPastedText",f=>{e=f(e,s||r,n)}),s)return e?new b(k.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):b.empty;let d=n.someProp("clipboardTextParser",f=>f(e,i,r,n));if(d)l=d;else{let f=i.marks(),{schema:u}=n.state,p=Ln.fromSchema(u);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let x=o.appendChild(document.createElement("p"));g&&x.appendChild(p.serializeNode(u.text(g,f)))})}}else n.someProp("transformPastedHTML",d=>{t=d(t,n)}),o=Xf(t),$s&&Qf(o);let a=o&&o.querySelector("[data-pm-slice]"),h=a&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(a.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let d=+h[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||Kr.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(c||h),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!$f.test(f.parentNode.nodeName)?{ignore:!0}:null}})),h)l=Zf(oa(l,+h[1],+h[2]),h[4]);else if(l=b.maxOpen(Gf(l.content,i),!0),l.openStart||l.openEnd){let d=0,f=0;for(let u=l.content.firstChild;d<l.openStart&&!u.type.spec.isolating;d++,u=u.firstChild);for(let u=l.content.lastChild;f<l.openEnd&&!u.type.spec.isolating;f++,u=u.lastChild);l=oa(l,d,f)}return n.someProp("transformPasted",d=>{l=d(l,n)}),l}var $f=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Gf(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(n.forEach(l=>{if(!o)return;let c=i.findWrapping(l.type),a;if(!c)return o=null;if(a=o.length&&s.length&&ba(c,s,l,o[o.length-1],0))o[o.length-1]=a;else{o.length&&(o[o.length-1]=ka(o[o.length-1],s.length));let h=Sa(l,c);o.push(h),i=i.matchType(h.type),s=c}}),o)return k.from(o)}return n}function Sa(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,k.from(n));return n}function ba(n,e,t,r,i){if(i<n.length&&i<e.length&&n[i]==e[i]){let s=ba(n,e,t,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==n.length-1?t.type:n[i+1]))return r.copy(r.content.append(k.from(Sa(t,n,i+1))))}}function ka(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,ka(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(k.empty,!0);return n.copy(t.append(r))}function vs(n,e,t,r,i,s){let o=e<0?n.firstChild:n.lastChild,l=o.content;return i<r-1&&(l=vs(l,e,t,r,i+1,s)),i>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,n.childCount>1||s<=i).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(k.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(l))}function oa(n,e,t){return e<n.openStart&&(n=new b(vs(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new b(vs(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}var Ca={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},la=null;function Ta(){return la||(la=document.implementation.createHTMLDocument("title"))}function Xf(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=Ta().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),i;if((i=r&&Ca[r[1].toLowerCase()])&&(n=i.map(s=>"<"+s+">").join("")+n+i.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=n,i)for(let s=0;s<i.length;s++)t=t.querySelector(i[s])||t;return t}function Qf(n){let e=n.querySelectorAll(Dt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function Zf(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:i,openStart:s,openEnd:o}=n;for(let l=r.length-2;l>=0;l-=2){let c=t.nodes[r[l]];if(!c||c.hasRequiredAttrs())break;i=k.from(c.create(r[l+1],i)),s++,o++}return new b(i,s,o)}var pe={},le={};function Xe(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}le.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!Da(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Kn&&Dt&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),js&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",i=>i(n,da(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||jf(n,t)?t.preventDefault():Xe(n,"key")};le.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};le.keypress=(n,e)=>{let t=e;if(Da(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||fe&&t.metaKey)return;if(n.someProp("handleKeyPress",i=>i(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof P)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(t.charCode);!/[\r\n]/.test(i)&&!n.someProp("handleTextInput",s=>s(n,r.$from.pos,r.$to.pos,i))&&n.dispatch(n.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function ai(n){return{left:n.clientX,top:n.clientY}}function eu(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function Xs(n,e,t,r,i){if(r==-1)return!1;let s=n.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(n.someProp(e,l=>o>s.depth?l(n,t,s.nodeAfter,s.before(o),i,!0):l(n,t,s.node(o),s.before(o),i,!1)))return!0;return!1}function sn(n,e,t){n.focused||n.focus();let r=n.state.tr.setSelection(e);t=="pointer"&&r.setMeta("pointer",!0),n.dispatch(r)}function tu(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&T.isSelectable(r)?(sn(n,new T(t),"pointer"),!0):!1}function nu(n,e){if(e==-1)return!1;let t=n.state.selection,r,i;t instanceof T&&(r=t.node);let s=n.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let l=o>s.depth?s.nodeAfter:s.node(o);if(T.isSelectable(l)){r&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?i=s.before(t.$from.depth):i=s.before(o);break}}return i!=null?(sn(n,T.create(n.state.doc,i),"pointer"),!0):!1}function ru(n,e,t,r,i){return Xs(n,"handleClickOn",e,t,r)||n.someProp("handleClick",s=>s(n,e,r))||(i?nu(n,t):tu(n,t))}function iu(n,e,t,r){return Xs(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",i=>i(n,e,r))}function su(n,e,t,r){return Xs(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",i=>i(n,e,r))||ou(n,t,r)}function ou(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(sn(n,P.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),l=i.before(s);if(o.inlineContent)sn(n,P.create(r,l+1,l+1+o.content.size),"pointer");else if(T.isSelectable(o))sn(n,T.create(r,l),"pointer");else continue;return!0}}function Qs(n){return oi(n)}var Ea=fe?"metaKey":"ctrlKey";pe.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=Qs(n),i=Date.now(),s="singleClick";i-n.input.lastClick.time<500&&eu(t,n.input.lastClick)&&!t[Ea]&&(n.input.lastClick.type=="singleClick"?s="doubleClick":n.input.lastClick.type=="doubleClick"&&(s="tripleClick")),n.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:s};let o=n.posAtCoords(ai(t));o&&(s=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new zs(n,o,t,!!r)):(s=="doubleClick"?iu:su)(n,o.pos,o.inside,t)?t.preventDefault():Xe(n,"pointer"))};var zs=class{constructor(e,t,r,i){this.view=e,this.pos=t,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Ea],this.allowDefault=r.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let h=e.state.doc.resolve(t.pos);s=h.parent,o=h.depth?h.before():0}let l=i?null:r.target,c=l?e.docView.nearestDesc(l,!0):null;this.target=c?c.dom:null;let{selection:a}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||a instanceof T&&a.from<=o&&a.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ci&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Xe(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Gs(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(ai(e))),this.updateAllowDefault(e),this.allowDefault||!t?Xe(this.view,"pointer"):ru(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ot&&this.mightDrag&&!this.mightDrag.node.isAtom||Dt&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(sn(this.view,M.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):Xe(this.view,"pointer")}move(e){this.updateAllowDefault(e),Xe(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};pe.touchstart=n=>{n.input.lastTouch=Date.now(),Qs(n),Xe(n,"pointer")};pe.touchmove=n=>{n.input.lastTouch=Date.now(),Xe(n,"pointer")};pe.contextmenu=n=>Qs(n);function Da(n,e){return n.composing?!0:Ot&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}var lu=Kn?5e3:-1;le.compositionstart=le.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),oi(n,!0),n.markCursor=null;else if(oi(n),ci&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){n.domSelection().collapse(o,o.nodeValue.length);break}else i=o,s=-1}}n.input.composing=!0}Oa(n,lu)};le.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionID++,Oa(n,20))};function Oa(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>oi(n),e))}function cu(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=au());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function au(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function oi(n,e=!1){if(!(Kn&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),cu(n),e||n.docView&&n.docView.dirty){let t=vf(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):n.updateState(n.state),!0}return!1}}function hu(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}var on=ln&&Ks<15||js&&Lf<604;pe.copy=le.cut=(n,e)=>{let t=e,r=n.state.selection,i=t.type=="cut";if(r.empty)return;let s=on?null:t.clipboardData,o=r.content(),{dom:l,text:c}=wa(n,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",l.innerHTML),s.setData("text/plain",c)):hu(n,l),i&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function du(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function fu(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?Js(n,r.value,null,n.input.shiftKey,e):Js(n,r.textContent,r.innerHTML,n.input.shiftKey,e)},50)}function Js(n,e,t,r,i){let s=xa(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",c=>c(n,i,s||b.empty)))return!0;if(!s)return!1;let o=du(s),l=o?n.state.tr.replaceSelectionWith(o,n.input.shiftKey):n.state.tr.replaceSelection(s);return n.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}le.paste=(n,e)=>{let t=e;if(n.composing&&!Kn)return;let r=on?null:t.clipboardData;r&&Js(n,r.getData("text/plain"),r.getData("text/html"),n.input.shiftKey,t)?t.preventDefault():fu(n,t)};var qs=class{constructor(e,t){this.slice=e,this.move=t}},Ma=fe?"altKey":"ctrlKey";pe.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let i=n.state.selection,s=i.empty?null:n.posAtCoords(ai(t));if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof T?i.to-1:i.to))){if(r&&r.mightDrag)n.dispatch(n.state.tr.setSelection(T.create(n.state.doc,r.mightDrag.pos)));else if(t.target&&t.target.nodeType==1){let a=n.docView.nearestDesc(t.target,!0);a&&a.node.type.spec.draggable&&a!=n.docView&&n.dispatch(n.state.tr.setSelection(T.create(n.state.doc,a.posBefore)))}}let o=n.state.selection.content(),{dom:l,text:c}=wa(n,o);t.dataTransfer.clearData(),t.dataTransfer.setData(on?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",on||t.dataTransfer.setData("text/plain",c),n.dragging=new qs(o,!t[Ma])};pe.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};le.dragover=le.dragenter=(n,e)=>e.preventDefault();le.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let i=n.posAtCoords(ai(t));if(!i)return;let s=n.state.doc.resolve(i.pos),o=r&&r.slice;o?n.someProp("transformPasted",p=>{o=p(o,n)}):o=xa(n,t.dataTransfer.getData(on?"Text":"text/plain"),on?null:t.dataTransfer.getData("text/html"),!1,s);let l=!!(r&&!t[Ma]);if(n.someProp("handleDrop",p=>p(n,t,o||b.empty,l))){t.preventDefault();return}if(!o)return;t.preventDefault();let c=o?Jc(n.state.doc,s.pos,o):s.pos;c==null&&(c=s.pos);let a=n.state.tr;l&&a.deleteSelection();let h=a.mapping.map(c),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=a.doc;if(d?a.replaceRangeWith(h,h,o.content.firstChild):a.replaceRange(h,h,o),a.doc.eq(f))return;let u=a.doc.resolve(h);if(d&&T.isSelectable(o.content.firstChild)&&u.nodeAfter&&u.nodeAfter.sameMarkup(o.content.firstChild))a.setSelection(new T(u));else{let p=a.mapping.map(c);a.mapping.maps[a.mapping.maps.length-1].forEach((g,x,S,ue)=>p=ue),a.setSelection(ma(n,u,a.doc.resolve(p)))}n.focus(),n.dispatch(a.setMeta("uiEvent","drop"))};pe.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Gs(n)},20))};pe.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};pe.beforeinput=(n,e)=>{if(Dt&&Kn&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",s=>s(n,da(8,"Backspace")))))return;let{$cursor:i}=n.state.selection;i&&i.pos>0&&n.dispatch(n.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let n in le)pe[n]=le[n];function Wn(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}var Ys=class n{constructor(e,t){this.toDOM=e,this.spec=t||Tt,this.side=this.spec.side||0}map(e,t,r,i){let{pos:s,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new Le(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof n&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Wn(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},Ct=class n{constructor(e,t){this.attrs=e,this.spec=t||Tt}map(e,t,r,i){let s=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new Le(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof n&&Wn(this.attrs,e.attrs)&&Wn(this.spec,e.spec)}static is(e){return e.type instanceof n}destroy(){}},Ws=class n{constructor(e,t){this.attrs=e,this.spec=t||Tt}map(e,t,r,i){let s=e.mapResult(t.from+i,1);if(s.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Le(s.pos-r,o.pos-r,this)}valid(e,t){let{index:r,offset:i}=e.content.findIndex(t.from),s;return i==t.from&&!(s=e.child(r)).isText&&i+s.nodeSize==t.to}eq(e){return this==e||e instanceof n&&Wn(this.attrs,e.attrs)&&Wn(this.spec,e.spec)}destroy(){}},Le=class n{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new n(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new n(e,e,new Ys(t,r))}static inline(e,t,r,i){return new n(e,t,new Ct(r,i))}static node(e,t,r,i){return new n(e,t,new Ws(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Ct}},rn=[],Tt={},ee=class n{constructor(e,t){this.local=e.length?e:rn,this.children=t.length?t:rn}static create(e,t){return t.length?li(t,e,0,Tt):X}find(e,t,r){let i=[];return this.findInner(e??0,t??1e9,i,0,r),i}findInner(e,t,r,i,s){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!s||s(l.spec))&&r.push(l.copy(l.from+i,l.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,r,i+l,s)}}map(e,t,r){return this==X||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Tt)}mapInner(e,t,r,i,s){let o;for(let l=0;l<this.local.length;l++){let c=this.local[l].map(e,r,i);c&&c.type.valid(t,c)?(o||(o=[])).push(c):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?uu(this.children,o||[],e,t,r,i,s):o?new n(o.sort(Et),rn):X}add(e,t){return t.length?this==X?n.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let i,s=0;e.forEach((l,c)=>{let a=c+r,h;if(h=Aa(t,l,a)){for(i||(i=this.children.slice());s<i.length&&i[s]<c;)s+=3;i[s]==c?i[s+2]=i[s+2].addInner(l,h,a+1):i.splice(s,0,c,c+l.nodeSize,li(h,l,a+1,Tt)),s+=3}});let o=Na(s?Ia(t):t,-r);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new n(o.length?this.local.concat(o).sort(Et):this.local,i||this.children)}remove(e){return e.length==0||this==X?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,l=r[s]+t,c=r[s+1]+t;for(let h=0,d;h<e.length;h++)(d=e[h])&&d.from>l&&d.to<c&&(e[h]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let a=r[s+2].removeInner(o,l+1);a!=X?r[s+2]=a:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let l=0;l<i.length;l++)i[l].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new n(i,r):X}forChild(e,t){if(this==X)return this;if(t.isLeaf)return n.empty;let r,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let s=e+1,o=s+t.content.size;for(let l=0;l<this.local.length;l++){let c=this.local[l];if(c.from<o&&c.to>s&&c.type instanceof Ct){let a=Math.max(s,c.from)-s,h=Math.min(o,c.to)-s;a<h&&(i||(i=[])).push(c.copy(a,h))}}if(i){let l=new n(i.sort(Et),rn);return r?new Hs([l,r]):l}return r||X}eq(e){if(this==e)return!0;if(!(e instanceof n)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Zs(this.localsInner(e))}localsInner(e){if(this==X)return rn;if(e.inlineContent||!this.local.some(Ct.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Ct||t.push(this.local[r]);return t}};ee.empty=new ee([],[]);ee.removeOverlap=Zs;var X=ee.empty,Hs=class n{constructor(e){this.members=e}map(e,t){let r=this.members.map(i=>i.map(e,t,Tt));return n.from(r)}forChild(e,t){if(t.isLeaf)return ee.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,t);s!=X&&(s instanceof n?r=r.concat(s.members):r.push(s))}return n.from(r)}eq(e){if(!(e instanceof n)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!t)t=s;else{r&&(t=t.slice(),r=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?Zs(r?t:t.sort(Et)):rn}static from(e){switch(e.length){case 0:return X;case 1:return e[0];default:return new n(e.every(t=>t instanceof ee)?e:e.reduce((t,r)=>t.concat(r instanceof ee?r:r.members),[]))}}};function uu(n,e,t,r,i,s,o){let l=n.slice();for(let a=0,h=s;a<t.maps.length;a++){let d=0;t.maps[a].forEach((f,u,p,g)=>{let x=g-p-(u-f);for(let S=0;S<l.length;S+=3){let ue=l[S+1];if(ue<0||f>ue+h-d)continue;let Ne=l[S]+h-d;u>=Ne?l[S+1]=f<=Ne?-2:-1:p>=i&&x&&(l[S]+=x,l[S+1]+=x)}d+=x}),h=t.maps[a].map(h,-1)}let c=!1;for(let a=0;a<l.length;a+=3)if(l[a+1]<0){if(l[a+1]==-2){c=!0,l[a+1]=-1;continue}let h=t.map(n[a]+s),d=h-i;if(d<0||d>=r.content.size){c=!0;continue}let f=t.map(n[a+1]+s,-1),u=f-i,{index:p,offset:g}=r.content.findIndex(d),x=r.maybeChild(p);if(x&&g==d&&g+x.nodeSize==u){let S=l[a+2].mapInner(t,x,h+1,n[a]+s+1,o);S!=X?(l[a]=d,l[a+1]=u,l[a+2]=S):(l[a+1]=-2,c=!0)}else c=!0}if(c){let a=pu(l,n,e,t,i,s,o),h=li(a,r,0,o);e=h.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<h.children.length;d+=3){let u=h.children[d];for(;f<l.length&&l[f]<u;)f+=3;l.splice(f,0,h.children[d],h.children[d+1],h.children[d+2])}}return new ee(e.sort(Et),l)}function Na(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let i=n[r];t.push(new Le(i.from+e,i.to+e,i.type))}return t}function pu(n,e,t,r,i,s,o){function l(c,a){for(let h=0;h<c.local.length;h++){let d=c.local[h].map(r,i,a);d?t.push(d):o.onRemove&&o.onRemove(c.local[h].spec)}for(let h=0;h<c.children.length;h+=3)l(c.children[h+2],c.children[h]+a+1)}for(let c=0;c<n.length;c+=3)n[c+1]==-1&&l(n[c+2],e[c]+s+1);return t}function Aa(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,i=null;for(let s=0,o;s<n.length;s++)(o=n[s])&&o.from>t&&o.to<r&&((i||(i=[])).push(o),n[s]=null);return i}function Ia(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function li(n,e,t,r){let i=[],s=!1;e.forEach((l,c)=>{let a=Aa(n,l,c+t);if(a){s=!0;let h=li(a,l,t+c+1,r);h!=X&&i.push(c,c+l.nodeSize,h)}});let o=Na(s?Ia(n):n,-t).sort(Et);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(r.onRemove&&r.onRemove(o[l].spec),o.splice(l--,1));return o.length||i.length?new ee(o,i):X}function Et(n,e){return n.from-e.from||n.to-e.to}function Zs(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let i=t+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==n&&(e=n.slice()),e[i]=s.copy(s.from,r.to),ca(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,s.from),ca(e,i,r.copy(s.from,r.to)));break}}}return e}function ca(n,e,t){for(;e<n.length&&Et(t,n[e])>0;)e++;n.splice(e,0,t)}var Fp=ln&&Ks<=11;var _a=()=>{let n=!0;return(e,t)=>{if(n){n=!1;try{e()}finally{n=!0}}else t!==void 0&&t()}};var mu=/[\uD800-\uDBFF]/,gu=/[\uDC00-\uDFFF]/,yu=(n,e)=>{let t=0,r=0;for(;t<n.length&&t<e.length&&n[t]===e[t];)t++;for(t>0&&mu.test(n[t-1])&&t--;r+t<n.length&&r+t<e.length&&n[n.length-r-1]===e[e.length-r-1];)r++;return r>0&&gu.test(n[n.length-r])&&r--,{index:t,remove:n.length-t-r,insert:e.slice(t,e.length-r)}},Ua=yu;var O=new nn("y-sync"),Ze=new nn("y-undo"),jn=new nn("yjs-cursor");var $n=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&e.sv.get(n.id.client)>n.id.clock&&!Be(e.ds,n.id),wu=[{light:"#ecd44433",dark:"#ecd444"}],xu=(n,e,t)=>{if(!n.has(t)){if(n.size<e.length){let r=te();n.forEach(i=>r.add(i)),e=e.filter(i=>!r.has(i))}n.set(t,To(e))}return n.get(t)},Ba=(n,{colors:e=wu,colorMapping:t=new Map,permanentUserData:r=null,onFirstRender:i=()=>{}}={})=>{let s=!1,o,l=new Ge({props:{editable:c=>{let a=O.getState(c);return a.snapshot==null&&a.prevSnapshot==null}},key:O,state:{init:(c,a)=>({type:n,doc:n.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,isUndoRedoOperation:!1,addToHistory:!0,colors:e,colorMapping:t,permanentUserData:r}),apply:(c,a)=>{let h=c.getMeta(O);if(h!==void 0){a=Object.assign({},a);for(let d in h)a[d]=h[d]}return a.addToHistory=c.getMeta("addToHistory")!==!1,a.isChangeOrigin=h!==void 0&&!!h.isChangeOrigin,a.isUndoRedoOperation=h!==void 0&&!!h.isChangeOrigin&&!!h.isUndoRedoOperation,a.binding!==null&&h!==void 0&&(h.snapshot!=null||h.prevSnapshot!=null)&&Jt(0,()=>{a.binding==null||a.binding.isDestroyed||(h.restore==null?a.binding._renderSnapshot(h.snapshot,h.prevSnapshot,a):(a.binding._renderSnapshot(h.snapshot,h.snapshot,a),delete a.restore,delete a.snapshot,delete a.prevSnapshot,a.binding.mux(()=>{a.binding._prosemirrorChanged(a.binding.prosemirrorView.state.doc)})))}),a}},view:c=>{let a=new di(n,c);return o?.destroy(),o=Jt(0,()=>{a._forceRerender(),c.dispatch(c.state.tr.setMeta(O,{binding:a})),i()}),{update:()=>{let h=l.getState(c.state);if(h.snapshot==null&&h.prevSnapshot==null&&(s||c.state.doc.content.findDiffStart(c.state.doc.type.createAndFill().content)!==null)){if(s=!0,h.addToHistory===!1&&!h.isChangeOrigin){let d=Ze.getState(c.state),f=d&&d.undoManager;f&&f.stopCapturing()}a.mux(()=>{h.doc.transact(d=>{d.meta.set("addToHistory",h.addToHistory),a._prosemirrorChanged(c.state.doc)},O)})}},destroy:()=>{o.destroy(),a.destroy()}}}});return l},Su=(n,e,t)=>{if(e!==null&&e.anchor!==null&&e.head!==null){let r=et(t.doc,t.type,e.anchor,t.mapping),i=et(t.doc,t.type,e.head,t.mapping);r!==null&&i!==null&&(n=n.setSelection(P.create(n.doc,r,i)))}},Gn=(n,e)=>({anchor:Mt(e.selection.anchor,n.type,n.mapping),head:Mt(e.selection.head,n.type,n.mapping)}),di=class{constructor(e,t){this.type=e,this.prosemirrorView=t,this.mux=_a(),this.isDestroyed=!1,this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=Gn(this,t.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(zt&&this._domSelectionInView===null&&(Jt(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){console.log(this.prosemirrorView._root);let e=this.prosemirrorView._root.getSelection(),t=this.prosemirrorView._root.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.getClientRects().length===0&&t.startContainer&&t.collapsed&&t.selectNodeContents(t.startContainer);let i=t.getBoundingClientRect(),s=Ie.documentElement;return i.bottom>=0&&i.right>=0&&i.left<=(window.innerWidth||s.clientWidth||0)&&i.top<=(window.innerHeight||s.clientHeight||0)}renderSnapshot(e,t){t||(t=Un(jt(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(O,{snapshot:e,prevSnapshot:t}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{let e=this.type.toArray().map(r=>hi(r,this.prosemirrorView.state.schema,this.mapping)).filter(r=>r!==null),t=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new b(k.from(e),0,0));t.setMeta(O,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(t)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{let e=this.type.toArray().map(r=>hi(r,this.prosemirrorView.state.schema,this.mapping)).filter(r=>r!==null),t=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new b(k.from(e),0,0));this.prosemirrorView.dispatch(t.setMeta(O,{isChangeOrigin:!0}))})}_renderSnapshot(e,t,r){e||(e=ss(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(i=>{let s=r.permanentUserData;s&&s.dss.forEach(a=>{ke(i,a,h=>{})});let o=(a,h)=>{let d=a==="added"?s.getUserByClientId(h.client):s.getUserByDeletedId(h);return{user:d,type:a,color:xu(r.colorMapping,r.colors,d)}},l=Pr(this.type,new Ke(t.ds,e.sv)).map(a=>!a._item.deleted||$n(a._item,e)||$n(a._item,t)?hi(a,this.prosemirrorView.state.schema,new Map,e,t,o):null).filter(a=>a!==null),c=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new b(k.from(l),0,0));this.prosemirrorView.dispatch(c.setMeta(O,{isChangeOrigin:!0}))},O)})}_typeChanged(e,t){let r=O.getState(this.prosemirrorView.state);if(e.length===0||r.snapshot!=null||r.prevSnapshot!=null){this.renderSnapshot(r.snapshot,r.prevSnapshot);return}this.mux(()=>{let i=(l,c)=>this.mapping.delete(c);ke(t,t.deleteSet,l=>{if(l.constructor===C){let c=l.content.type;c&&this.mapping.delete(c)}}),t.changed.forEach(i),t.changedParentTypes.forEach(i);let s=this.type.toArray().map(l=>Pa(l,this.prosemirrorView.state.schema,this.mapping)).filter(l=>l!==null),o=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new b(k.from(s),0,0));Su(o,this.beforeTransactionSelection,this),o=o.setMeta(O,{isChangeOrigin:!0,isUndoRedoOperation:t.origin instanceof at}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&o.scrollIntoView(),this.prosemirrorView.dispatch(o)})}_prosemirrorChanged(e){this.doc.transact(()=>{Qn(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=Gn(this,this.prosemirrorView.state)},O)}destroy(){this.isDestroyed=!0,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}},Pa=(n,e,t,r,i,s)=>{let o=t.get(n);if(o===void 0){if(n instanceof Y)return hi(n,e,t,r,i,s);throw re()}return o},hi=(n,e,t,r,i,s)=>{let o=[],l=c=>{if(c.constructor===Y){let a=Pa(c,e,t,r,i,s);a!==null&&o.push(a)}else{let a=bu(c,e,t,r,i,s);a!==null&&a.forEach(h=>{h!==null&&o.push(h)})}};r===void 0||i===void 0?n.toArray().forEach(l):Pr(n,new Ke(i.ds,r.sv)).forEach(l);try{let c=n.getAttributes(r);r!==void 0&&($n(n._item,r)?$n(n._item,i)||(c.ychange=s?s("added",n._item.id):{type:"added"}):c.ychange=s?s("removed",n._item.id):{type:"removed"});let a=e.node(n.nodeName,c,o);return t.set(n,a),a}catch{return n.doc.transact(a=>{n._item.delete(a)},O),t.delete(n),null}},bu=(n,e,t,r,i,s)=>{let o=[],l=n.toDelta(r,i,s);try{for(let c=0;c<l.length;c++){let a=l[c],h=[];for(let d in a.attributes)h.push(e.mark(d,a.attributes[d]));o.push(e.text(a.insert,h))}}catch{return n.doc.transact(a=>{n._item.delete(a)},O),null}return o},ku=(n,e)=>{let t=new G,r=n.map(i=>({insert:i.text,attributes:La(i.marks)}));return t.applyDelta(r),e.set(t,n),t},Cu=(n,e)=>{let t=new Y(n.type.name);for(let r in n.attrs){let i=n.attrs[r];i!==null&&r!=="ychange"&&t.setAttribute(r,i)}return t.insert(0,ui(n).map(r=>eo(r,e))),e.set(t,n),t},eo=(n,e)=>n instanceof Array?ku(n,e):Cu(n,e),Ra=n=>typeof n=="object"&&n!==null,no=(n,e)=>{let t=Object.keys(n).filter(i=>n[i]!==null),r=t.length===Object.keys(e).filter(i=>e[i]!==null).length;for(let i=0;i<t.length&&r;i++){let s=t[i],o=n[s],l=e[s];r=s==="ychange"||o===l||Ra(o)&&Ra(l)&&no(o,l)}return r},ui=n=>{let e=n.content.content,t=[];for(let r=0;r<e.length;r++){let i=e[r];if(i.isText){let s=[];for(let o=e[r];r<e.length&&o.isText;o=e[++r])s.push(o);r--,t.push(s)}else t.push(i)}return t},Fa=(n,e)=>{let t=n.toDelta();return t.length===e.length&&t.every((r,i)=>r.insert===e[i].text&&Di(r.attributes||{}).length===e[i].marks.length&&e[i].marks.every(s=>no(r.attributes[s.type.name]||{},s.attrs)))},Xn=(n,e)=>{if(n instanceof Y&&!(e instanceof Array)&&to(n,e)){let t=ui(e);return n._length===t.length&&no(n.getAttributes(),e.attrs)&&n.toArray().every((r,i)=>Xn(r,t[i]))}return n instanceof G&&e instanceof Array&&Fa(n,e)},fi=(n,e)=>n===e||n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((t,r)=>e[r]===t),Va=(n,e,t)=>{let r=n.toArray(),i=ui(e),s=i.length,o=r.length,l=ne(o,s),c=0,a=0,h=!1;for(;c<l;c++){let d=r[c],f=i[c];if(fi(t.get(d),f))h=!0;else if(!Xn(d,f))break}for(;c+a<l;a++){let d=r[o-a-1],f=i[s-a-1];if(fi(t.get(d),f))h=!0;else if(!Xn(d,f))break}return{equalityFactor:c+a,foundMappedChild:h}},Tu=n=>{let e="",t=n._start,r={};for(;t!==null;)t.deleted||(t.countable&&t.content instanceof oe?e+=t.content.str:t.content instanceof I&&(r[t.content.key]=null)),t=t.right;return{str:e,nAttrs:r}},Eu=(n,e,t)=>{t.set(n,e);let{nAttrs:r,str:i}=Tu(n),s=e.map(a=>({insert:a.text,attributes:Object.assign({},r,La(a.marks))})),{insert:o,remove:l,index:c}=Ua(i,s.map(a=>a.insert).join(""));n.delete(c,l),n.insert(c,o),n.applyDelta(s.map(a=>({retain:a.insert.length,attributes:a.attributes})))},La=n=>{let e={};return n.forEach(t=>{t.type.name!=="ychange"&&(e[t.type.name]=t.attrs)}),e},Qn=(n,e,t,r)=>{if(e instanceof Y&&e.nodeName!==t.type.name)throw new Error("node name mismatch!");if(r.set(e,t),e instanceof Y){let d=e.getAttributes(),f=t.attrs;for(let u in f)f[u]!==null?d[u]!==f[u]&&u!=="ychange"&&e.setAttribute(u,f[u]):e.removeAttribute(u);for(let u in d)f[u]===void 0&&e.removeAttribute(u)}let i=ui(t),s=i.length,o=e.toArray(),l=o.length,c=ne(s,l),a=0,h=0;for(;a<c;a++){let d=o[a],f=i[a];if(!fi(r.get(d),f))if(Xn(d,f))r.set(d,f);else break}for(;h+a+1<c;h++){let d=o[l-h-1],f=i[s-h-1];if(!fi(r.get(d),f))if(Xn(d,f))r.set(d,f);else break}n.transact(()=>{for(;l-a-h>0&&s-a-h>0;){let f=o[a],u=i[a],p=o[l-h-1],g=i[s-h-1];if(f instanceof G&&u instanceof Array)Fa(f,u)||Eu(f,u,r),a+=1;else{let x=f instanceof Y&&to(f,u),S=p instanceof Y&&to(p,g);if(x&&S){let ue=Va(f,u,r),Ne=Va(p,g,r);ue.foundMappedChild&&!Ne.foundMappedChild?S=!1:!ue.foundMappedChild&&Ne.foundMappedChild||ue.equalityFactor<Ne.equalityFactor?x=!1:S=!1}x?(Qn(n,f,u,r),a+=1):S?(Qn(n,p,g,r),h+=1):(r.delete(e.get(a)),e.delete(a,1),e.insert(a,[eo(u,r)]),a+=1)}}let d=l-a-h;if(l===1&&s===0&&o[0]instanceof G?(r.delete(o[0]),o[0].delete(0,o[0].length)):d>0&&(e.slice(a,a+d).forEach(f=>r.delete(f)),e.delete(a,d)),a+h<s){let f=[];for(let u=a;u<s-h;u++)f.push(eo(i[u],r));e.insert(a,f)}},O)},to=(n,e)=>!(e instanceof Array)&&n.nodeName===e.type.name;var Zn=null,Du=()=>{let n=Zn;Zn=null,n.forEach((e,t)=>{let r=t.state.tr,i=O.getState(t.state);i&&i.binding&&!i.binding.isDestroyed&&(e.forEach((s,o)=>{r.setMeta(o,s)}),t.dispatch(r))})},ro=(n,e,t)=>{Zn||(Zn=new Map,Jt(0,Du)),F(Zn,n,_).set(e,t)},Mt=(n,e,t)=>{if(n===0)return _n(e,0);let r=e._first===null?null:e._first.content.type;for(;r!==null&&e!==r;){if(r instanceof G){if(r._length>=n)return _n(r,n);if(n-=r._length,r._item!==null&&r._item.next!==null)r=r._item.next.content.type;else{do r=r._item===null?null:r._item.parent,n--;while(r!==e&&r!==null&&r._item!==null&&r._item.next===null);r!==null&&r!==e&&(r=r._item===null?null:r._item.next.content.type)}}else{let i=(t.get(r)||{nodeSize:0}).nodeSize;if(r._first!==null&&n<i)r=r._first.content.type,n--;else{if(n===1&&r._length===0&&i>1)return new Ee(r._item===null?null:r._item.id,r._item===null?mt(r):null,null);if(n-=i,r._item!==null&&r._item.next!==null)r=r._item.next.content.type;else{if(n===0)return r=r._item===null?r:r._item.parent,new Ee(r._item===null?null:r._item.id,r._item===null?mt(r):null,null);do r=r._item.parent,n--;while(r!==e&&r._item.next===null);r!==e&&(r=r._item.next.content.type)}}}if(r===null)throw J();if(n===0&&r.constructor!==G&&r!==e)return Ou(r._item.parent,r._item)}return _n(e,e._length)},Ou=(n,e)=>{let t=null,r=null;return n._item===null?r=mt(n):t=w(n._item.id.client,n._item.id.clock),new Ee(t,r,e.id)},et=(n,e,t,r)=>{let i=is(t,n);if(i===null||i.type!==e&&!ct(e,i.type._item))return null;let s=i.type,o=0;if(s.constructor===G)o=i.index;else if(s._item===null||!s._item.deleted){let l=s._first,c=0;for(;c<s._length&&c<i.index&&l!==null;){if(!l.deleted){let a=l.content.type;c++,a instanceof G?o+=a._length:o+=r.get(a).nodeSize}l=l.right}o+=1}for(;s!==e&&s._item!==null;){let l=s._item.parent;if(l._item===null||!l._item.deleted){o+=1;let c=l._first;for(;c!==null;){let a=c.content.type;if(a===s)break;c.deleted||(a instanceof G?o+=a._length:o+=r.get(a).nodeSize),c=c.right}}s=l}return o-1};function va(n,e="prosemirror"){let t=new Re,r=t.get(e,Oe);return r.doc?(io(n,r),r.doc):t}function io(n,e){let t=e||new Oe,r=t.doc?t.doc:{transact:i=>i(void 0)};return Qn(r,t,n,new Map),t}var Mu=(n,e,t)=>n!==e,Nu=n=>{let e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${n.color}`);let t=document.createElement("div");t.setAttribute("style",`background-color: ${n.color}`),t.insertBefore(document.createTextNode(n.name),null);let r=document.createTextNode("\u2060"),i=document.createTextNode("\u2060");return e.insertBefore(r,null),e.insertBefore(t,null),e.insertBefore(i,null),e},Au=n=>({style:`background-color: ${n.color}70`,class:"ProseMirror-yjs-selection"}),Iu=/^#[0-9a-fA-F]{6}$/,za=(n,e,t,r,i)=>{let s=O.getState(n),o=s.doc,l=[];return s.snapshot!=null||s.prevSnapshot!=null||s.binding===null?ee.create(n.doc,[]):(e.getStates().forEach((c,a)=>{if(t(o.clientID,a,c)&&c.cursor!=null){let h=c.user||{};h.color==null?h.color="#ffa500":Iu.test(h.color)||console.warn("A user uses an unsupported color format",h),h.name==null&&(h.name=`User: ${a}`);let d=et(o,s.type,gt(c.cursor.anchor),s.binding.mapping),f=et(o,s.type,gt(c.cursor.head),s.binding.mapping);if(d!==null&&f!==null){let u=ce(n.doc.content.size-1,0);d=ne(d,u),f=ne(f,u),l.push(Le.widget(f,()=>r(h),{key:a+"",side:10}));let p=ne(d,f),g=ce(d,f);l.push(Le.inline(p,g,i(h),{inclusiveEnd:!0,inclusiveStart:!1}))}}}),ee.create(n.doc,l))},_u=(n,{awarenessStateFilter:e=Mu,cursorBuilder:t=Nu,selectionBuilder:r=Au,getSelection:i=o=>o.selection}={},s="cursor")=>new Ge({key:jn,state:{init(o,l){return za(l,n,e,t,r)},apply(o,l,c,a){let h=O.getState(a),d=o.getMeta(jn);return h&&h.isChangeOrigin||d&&d.awarenessUpdated?za(a,n,e,t,r):l.map(o.mapping,o.doc)}},props:{decorations:o=>jn.getState(o)},view:o=>{let l=()=>{o.docView&&ro(o,jn,{awarenessUpdated:!0})},c=()=>{let a=O.getState(o.state),h=n.getLocalState()||{};if(a.binding!=null)if(o.hasFocus()){let d=i(o.state),f=Mt(d.anchor,a.type,a.binding.mapping),u=Mt(d.head,a.type,a.binding.mapping);(h.cursor==null||!Ur(gt(h.cursor.anchor),f)||!Ur(gt(h.cursor.head),u))&&n.setLocalStateField(s,{anchor:f,head:u})}else h.cursor!=null&&et(a.doc,a.type,gt(h.cursor.anchor),a.binding.mapping)!==null&&n.setLocalStateField(s,null)};return n.on("change",l),o.dom.addEventListener("focusin",c),o.dom.addEventListener("focusout",c),{update:c,destroy:()=>{o.dom.removeEventListener("focusin",c),o.dom.removeEventListener("focusout",c),n.off("change",l),n.setLocalStateField(s,null)}}}});var Uu=n=>{let e=Ze.getState(n).undoManager;if(e!=null)return e.undo(),!0},Ru=n=>{let e=Ze.getState(n).undoManager;if(e!=null)return e.redo(),!0},Vu=new Set(["paragraph"]),Bu=(n,e)=>!(n instanceof C)||!(n.content instanceof Z)||!(n.content.type instanceof je||n.content.type instanceof Y&&e.has(n.content.type.nodeName))||n.content.type._length===0,Pu=({protectedNodes:n=Vu,trackedOrigins:e=[],undoManager:t=null}={})=>new Ge({key:Ze,state:{init:(r,i)=>{let s=O.getState(i),o=t||new at(s.type,{trackedOrigins:new Set([O].concat(e)),deleteFilter:l=>Bu(l,n),captureTransaction:l=>l.meta.get("addToHistory")!==!1});return{undoManager:o,prevSel:null,hasUndoOps:o.undoStack.length>0,hasRedoOps:o.redoStack.length>0}},apply:(r,i,s,o)=>{let l=O.getState(o).binding,c=i.undoManager,a=c.undoStack.length>0,h=c.redoStack.length>0;return l?{undoManager:c,prevSel:Gn(l,s),hasUndoOps:a,hasRedoOps:h}:a!==i.hasUndoOps||h!==i.hasRedoOps?Object.assign({},i,{hasUndoOps:c.undoStack.length>0,hasRedoOps:c.redoStack.length>0}):i}},view:r=>{let i=O.getState(r.state),s=Ze.getState(r.state).undoManager;return s.on("stack-item-added",({stackItem:o})=>{let l=i.binding;l&&o.meta.set(l,Ze.getState(r.state).prevSel)}),s.on("stack-item-popped",({stackItem:o})=>{let l=i.binding;l&&(l.beforeTransactionSelection=o.meta.get(l)||l.beforeTransactionSelection)}),{destroy:()=>{s.destroy()}}}});export{ys as WebsocketProvider,Gt as Y,va as prosemirrorToYDoc,io as prosemirrorToYXmlFragment,Ru as redo,Uu as undo,_u as yCursorPlugin,Ba as ySyncPlugin,Pu as yUndoPlugin};
